<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoodie or Nah</title>
  <meta name="description" content="Settle the hoodie debate. Hoodie, maybe, or nah based on your local weather." />
  <meta name="theme-color" content="#0b0b0f" />

  <!-- Favicons / App Icons -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" href="/favicon-32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16.png" sizes="16x16" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
  <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />

  <!-- Open Graph -->
  <meta property="og:title" content="Hoodie or Nah" />
  <meta property="og:description" content="Settle the hoodie debate in one click. Hoodie, maybe, or nah based on your local weather." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://hoodieornah.com" />
  <meta property="og:image" content="https://hoodieornah.com/og.png" />

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Hoodie or Nah" />
  <meta name="twitter:description" content="Hoodie, maybe, or nah. Based on your weather." />
  <meta name="twitter:image" content="https://hoodieornah.com/og.png" />

  <style>
    :root{
      --bg:#0b0b0f;
      --panel:#0f1016;
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.48);
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --radius:22px;
      --radius2:28px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(120,160,255,.12), transparent 45%),
        radial-gradient(900px 500px at 90% 20%, rgba(255,255,255,.06), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 1280px;
      margin: 0 auto;
      padding: 18px 18px 14px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 16px 18px;
      border:1px solid var(--border);
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position: sticky;
      top: 14px;
      backdrop-filter: blur(10px);
      z-index: 5;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 14px;
      min-width: 0;
    }

    .brand-btn{
      width: 54px;
      height: 54px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.10), rgba(255,255,255,.02));
      display:grid;
      place-items:center;
      padding:0;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      box-shadow: 0 8px 28px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .brand-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(140,170,255,.35);
      box-shadow: 0 10px 34px rgba(0,0,0,.55), 0 0 26px rgba(120,160,255,.14);
    }
    .brand-btn:active{transform: translateY(0px) scale(.99)}
    .brand-btn img{
      width: 40px;
      height: 40px;
      display:block;
      image-rendering: auto;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.55));
      border-radius: 12px;
    }

    .wordmark{
      display:flex;
      flex-direction:column;
      line-height:1.05;
      min-width:0;
    }
    .wordmark .title{
      font-size: 22px;
      font-weight: 780;
      letter-spacing: .2px;
      white-space: nowrap;
    }
    .wordmark .tag{
      font-size: 12px;
      color: var(--muted2);
      letter-spacing: .2px;
      margin-top: 3px;
    }

    .pill{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-weight: 650;
      letter-spacing: .2px;
      user-select:none;
      max-width: 46%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .pill .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.32);
      box-shadow: 0 0 0 4px rgba(255,255,255,.04);
      flex: 0 0 auto;
    }

    .spinner{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.24);
      border-top-color: rgba(255,255,255,.82);
      animation: spin .75s linear infinite;
      flex: 0 0 auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    main{
      margin-top: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.55fr 1fr;
      gap: 16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .pill{max-width: 60%}
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--border2);
      background:
        radial-gradient(900px 500px at 10% 0%, rgba(120,160,255,.10), transparent 42%),
        radial-gradient(700px 420px at 85% 10%, rgba(255,255,255,.07), transparent 50%),
        rgba(0,0,0,.22);
      padding: 18px;
      min-height: 390px;
      position:relative;
      overflow:hidden;
    }

    .card-right{
      border-radius: var(--radius);
      border: 1px solid var(--border2);
      background: rgba(0,0,0,.18);
      padding: 18px;
      min-height: 390px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .big{
      font-size: 86px;
      font-weight: 900;
      letter-spacing: .6px;
      margin: 8px 0 6px;
    }
    @media (max-width: 560px){
      .big{font-size: 56px}
    }
    .sub{
      color: var(--muted);
      font-size: 16px;
      margin: 0 0 10px;
      max-width: 52ch;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 16px 0 12px;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 6px;
    }
    @media (max-width: 560px){
      .stats{grid-template-columns:1fr}
    }

    .stat{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px 12px;
    }
    .stat .k{
      font-size: 12px;
      color: var(--muted2);
      font-weight: 750;
      letter-spacing: .2px;
      margin-bottom: 6px;
    }
    .stat .v{
      font-size: 16px;
      font-weight: 820;
      letter-spacing: .2px;
    }
    .stat .s{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      line-height: 1.35;
    }

    h3{
      margin: 0 0 2px;
      font-size: 22px;
      font-weight: 820;
      letter-spacing: .2px;
    }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 10px 0 8px;
      font-weight: 650;
    }

    select, input{
      width:100%;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.03);
      color: var(--text);
      outline: none;
      font-size: 14px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.15);
    }
    input::placeholder{color: rgba(255,255,255,.35)}

    .btn-row{
      display:flex;
      gap: 10px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    button{
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 740;
      letter-spacing: .2px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    button:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
    }
    button:active{transform: translateY(0px) scale(.99)}
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
      transform:none;
    }

    .mini{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 12px 12px;
      margin-top: 6px;
    }
    .mini .row{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
      padding: 6px 2px;
      color: var(--muted);
      font-weight: 650;
      font-size: 13px;
    }
    .mini .row strong{
      color: var(--text);
      font-weight: 820;
    }

    .in-card-footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-top: 14px;
      color: var(--muted);
      font-weight: 650;
      padding: 2px 2px 0;
    }

    .support{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.02);
      text-decoration:none;
      color: var(--text);
      font-weight: 780;
    }
    .support:hover{border-color: rgba(255,255,255,.18)}
    .support svg{
      width: 16px;
      height: 16px;
      opacity: .9;
      flex: 0 0 auto;
    }

    .site-footer{
      margin-top: 14px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      padding: 14px 14px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }
    .site-footer a{
      color: rgba(255,255,255,.82);
      text-decoration:none;
      border-bottom: 1px solid rgba(255,255,255,.20);
    }
    .site-footer a:hover{
      border-bottom-color: rgba(255,255,255,.40);
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.75);
      color: var(--text);
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 30;
      max-width: min(640px, calc(100% - 24px));
      text-align:center;
      font-weight: 700;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <button class="brand-btn" id="brandHome" aria-label="Hoodie or Nah home">
          <!-- PNG logo (big enough to actually see) -->
          <img src="/android-chrome-192x192.png" alt="Hoodie or Nah logo" />
        </button>

        <div class="wordmark">
          <div class="title">Hoodie or Nah</div>
          <div class="tag">Hoodie judgment, delivered.</div>
        </div>
      </div>

      <div class="pill" id="wherePill" title="Location">
        <span class="dot" aria-hidden="true"></span>
        <span id="whereText">Near you</span>
      </div>
    </header>

    <main>
      <div class="grid">
        <!-- Left: Result -->
        <section class="card" aria-live="polite">
          <div class="big" id="bigWord">LOADING</div>
          <p class="sub" id="oneLiner">Grabbing your weather. Try not to panic.</p>

          <div class="divider"></div>

          <!-- Fill the space with structured info instead of a void -->
          <div class="stats">
            <div class="stat">
              <div class="k">Location</div>
              <div class="v" id="locLine">Near you</div>
              <div class="s" id="locSource">Source: guessing until you say otherwise.</div>
            </div>

            <div class="stat">
              <div class="k">Right now</div>
              <div class="v" id="tempLine">--</div>
              <div class="s" id="feelWindLine">Feels like: --  |  Wind: --</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="in-card-footer">
            <a class="support" href="https://www.buymeacoffee.com/" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6.5 8.2h9.2c.8 0 1.4.6 1.4 1.4v3.7c0 2.7-2.2 4.9-4.9 4.9H10c-2.7 0-4.9-2.2-4.9-4.9V9.6c0-.8.6-1.4 1.4-1.4Z" stroke="rgba(255,255,255,.88)" stroke-width="1.7"/>
                <path d="M17.1 9.6h1.1c1.3 0 2.3 1 2.3 2.3s-1 2.3-2.3 2.3h-1.1" stroke="rgba(255,255,255,.78)" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M7.6 21h9.2" stroke="rgba(255,255,255,.50)" stroke-width="1.7" stroke-linecap="round"/>
              </svg>
              <span>Support the hoodie science</span>
            </a>

            <div id="unitsLine">Units: --</div>
          </div>
        </section>

        <!-- Right: Controls -->
        <aside class="card-right">
          <div>
            <h3>How do you run?</h3>
            <select id="runSelect" aria-label="How do you run">
              <option value="cold">Always cold</option>
              <option value="normal" selected>Normal</option>
              <option value="hot">Always hot</option>
            </select>

            <label for="manualInput">Manual location (optional)</label>
            <input id="manualInput" list="locList" placeholder="City, Region, Country or ZIP (example)" autocomplete="off" />
            <datalist id="locList"></datalist>

            <div class="btn-row">
              <button id="spinBtn" type="button">Spin the globe</button>
              <button id="gpsBtn" type="button">Use my GPS</button>
            </div>
          </div>

          <!-- Use the space with a compact summary panel -->
          <div class="mini" aria-live="polite">
            <div class="row"><span>Using</span><strong id="usingLine">Auto</strong></div>
            <div class="row"><span>Location</span><strong id="usingLoc">Near you</strong></div>
            <div class="row"><span>Units</span><strong id="usingUnits">--</strong></div>
            <div class="row"><span>Tip</span><strong id="tipLine">Type a city and press Enter.</strong></div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Real footer -->
    <div class="site-footer">
      <div>
        <strong style="color:rgba(255,255,255,.86);">Contact</strong><br/>
        <a href="mailto:info@hoodieornah.com">info@hoodieornah.com</a><br/>
        <span style="color:rgba(255,255,255,.42);">We read it. Eventually.</span>
      </div>

      <div style="text-align:right; max-width: 64ch;">
        Weather data via Open-Meteo. Geocoding via OpenStreetMap Nominatim.<br/>
        This site is for entertainment and mild arguments only. No warranties. Donâ€™t sue us because you wore a hoodie in a blizzard.
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const state = {
      run: "normal",
      source: "auto",
      placeLabel: "Near you",
      lat: null,
      lon: null,
      countryCode: null,
      units: "F",
      last: { temp: null, feels: null, wind: null }
    };

    const wherePill = document.getElementById("wherePill");
    const whereText = document.getElementById("whereText");
    const bigWord = document.getElementById("bigWord");
    const oneLiner = document.getElementById("oneLiner");
    const toastEl = document.getElementById("toast");

    const runSelect = document.getElementById("runSelect");
    const manualInput = document.getElementById("manualInput");
    const locList = document.getElementById("locList");
    const spinBtn = document.getElementById("spinBtn");
    const gpsBtn = document.getElementById("gpsBtn");
    const brandHome = document.getElementById("brandHome");

    const locLine = document.getElementById("locLine");
    const locSource = document.getElementById("locSource");
    const tempLine = document.getElementById("tempLine");
    const feelWindLine = document.getElementById("feelWindLine");
    const unitsLine = document.getElementById("unitsLine");

    const usingLine = document.getElementById("usingLine");
    const usingLoc = document.getElementById("usingLoc");
    const usingUnits = document.getElementById("usingUnits");
    const tipLine = document.getElementById("tipLine");

    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toastEl.classList.remove("show"), 2200);
    }

    function setPill(text, { loading=false } = {}){
      if (loading){
        wherePill.innerHTML = '<span class="spinner" aria-hidden="true"></span><span id="whereText">Locating...</span>';
        return;
      }
      wherePill.innerHTML = '<span class="dot" aria-hidden="true"></span><span id="whereText"></span>';
      document.getElementById("whereText").textContent = text;
    }

    function countryUsesF(countryCode){
      return ["US", "LR", "MM"].includes((countryCode || "").toUpperCase());
    }

    function runOffset(run){
      if (run === "cold") return -4;
      if (run === "hot") return +4;
      return 0;
    }

    function decide(tempF, feelsF, run){
      const t = (Number.isFinite(feelsF) ? feelsF : tempF) + runOffset(run);

      if (t <= 25) return { word: "NAH", line: "That air hurts your face. Bundle up." };
      if (t <= 35) return { word: "NAH", line: "Hoodie alone is cute. So is hypothermia." };
      if (t <= 45) return { word: "MAYBE", line: "Hoodie plus a jacket. Donâ€™t get cocky." };
      if (t <= 60) return { word: "HOODIE", line: "Prime hoodie weather. Enjoy your moment." };
      if (t <= 70) return { word: "MAYBE", line: "Hoodie if you like options. Otherwise, nah." };
      if (t <= 82) return { word: "NAH", line: "Youâ€™re gonna regret sleeves in 10 minutes." };
      return { word: "NAH", line: "Itâ€™s basically a warm hug from the sun. No hoodie." };
    }

    function fmtTemp(val, units){
      if (!Number.isFinite(val)) return "--";
      return Math.round(val) + "Â°" + units;
    }

    function fmtWind(val, units){
      if (!Number.isFinite(val)) return "--";
      return Math.round(val) + (units === "F" ? " mph" : " km/h");
    }

    function toF(c){ return (c * 9/5) + 32; }

    function setLoading(on){
      if (on){
        bigWord.textContent = "LOADING";
        oneLiner.textContent = "Grabbing your weather. Try not to panic.";
        tempLine.textContent = "--";
        feelWindLine.textContent = "Feels like: --  |  Wind: --";
        unitsLine.textContent = "Units: --";
        usingUnits.textContent = "--";
      }
    }

    function updateSourceUI(){
      const sourceName =
        state.source === "gps" ? "GPS" :
        state.source === "manual" ? "Manual" :
        state.source === "globe" ? "Globe" : "Auto";

      usingLine.textContent = sourceName;
      usingLoc.textContent = state.placeLabel;
      usingUnits.textContent = state.units === "F" ? "Fahrenheit" : "Celsius";

      if (state.source === "manual") tipLine.textContent = "Manual override wins. Always.";
      else if (state.source === "gps") tipLine.textContent = "GPS did the work. Respect.";
      else if (state.source === "globe") tipLine.textContent = "Random place, real judgment.";
      else tipLine.textContent = "Type a city and press Enter.";

      locLine.textContent = state.placeLabel;
      locSource.textContent = "Source: " + sourceName + ".";
      unitsLine.textContent = "Units: " + (state.units === "F" ? "Fahrenheit" : "Celsius");
    }

    let suggestAbort = null;

    async function suggestLocations(q){
      if (!q || q.trim().length < 3){
        locList.innerHTML = "";
        return;
      }
      if (suggestAbort) suggestAbort.abort();
      suggestAbort = new AbortController();

      const url = "https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&limit=6&q=" + encodeURIComponent(q);
      const res = await fetch(url, {
        signal: suggestAbort.signal,
        headers: { "Accept": "application/json" }
      });
      if (!res.ok) return;

      const data = await res.json();
      locList.innerHTML = data.map(item => {
        const label = item.display_name;
        return '<option value="' + escapeHtml(label) + '"></option>';
      }).join("");
    }

    async function geocodeDisplayName(displayName){
      const url = "https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&limit=1&q=" + encodeURIComponent(displayName);
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if (!res.ok) throw new Error("geocode_failed");
      const data = await res.json();
      if (!data || !data[0]) throw new Error("no_results");

      const item = data[0];
      const cc = item.address && item.address.country_code ? item.address.country_code.toUpperCase() : null;

      return {
        lat: parseFloat(item.lat),
        lon: parseFloat(item.lon),
        label: simplifyLabel(item),
        countryCode: cc
      };
    }

    async function reverseGeocode(lat, lon){
      const url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&addressdetails=1&lat=" + encodeURIComponent(lat) + "&lon=" + encodeURIComponent(lon);
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if (!res.ok) throw new Error("reverse_failed");
      const data = await res.json();
      const cc = data.address && data.address.country_code ? data.address.country_code.toUpperCase() : null;
      return {
        label: simplifyLabel(data),
        countryCode: cc
      };
    }

    function simplifyLabel(obj){
      const a = obj.address || {};
      const city = a.city || a.town || a.village || a.hamlet || a.county || a.state || "";
      const stateName = a.state || a.region || "";
      const country = a.country || "";
      const cc = a.country_code ? a.country_code.toUpperCase() : null;

      if (cc === "US"){
        const st = a.state_code || stateName;
        if (city && st) return city + ", " + st;
        if (obj.display_name) return obj.display_name.split(",").slice(0,2).join(",").trim();
        return "Near you";
      }

      if (city && country) return city + ", " + country;
      if (obj.display_name) return obj.display_name.split(",").slice(0,2).join(",").trim();
      return "Near you";
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    async function fetchWeather(lat, lon, units){
      const tempUnit = units === "F" ? "fahrenheit" : "celsius";
      const windUnit = units === "F" ? "mph" : "kmh";

      const url =
        "https://api.open-meteo.com/v1/forecast" +
        "?latitude=" + encodeURIComponent(lat) +
        "&longitude=" + encodeURIComponent(lon) +
        "&current=temperature_2m,apparent_temperature,wind_speed_10m" +
        "&temperature_unit=" + tempUnit +
        "&windspeed_unit=" + windUnit +
        "&timezone=auto";

      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if (!res.ok) throw new Error("weather_failed");
      return await res.json();
    }

    function renderResult(temp, feels, wind){
      state.last = { temp, feels, wind };

      const tempF = state.units === "F" ? temp : toF(temp);
      const feelsF = state.units === "F" ? feels : toF(feels);

      const d = decide(tempF, feelsF, state.run);
      bigWord.textContent = d.word;
      oneLiner.textContent = d.line;

      tempLine.textContent = fmtTemp(temp, state.units);
      feelWindLine.textContent = "Feels like: " + fmtTemp(feels, state.units) + "  |  Wind: " + fmtWind(wind, state.units);
      unitsLine.textContent = "Units: " + (state.units === "F" ? "Fahrenheit" : "Celsius");
      usingUnits.textContent = state.units === "F" ? "Fahrenheit" : "Celsius";
    }

    async function updateWeatherFromLatLon(lat, lon, label, countryCode, source){
      state.lat = lat;
      state.lon = lon;
      state.countryCode = countryCode || state.countryCode;
      state.source = source || state.source;

      state.units = countryUsesF(state.countryCode) ? "F" : "C";
      state.placeLabel = label || "Near you";

      setPill("ðŸ“ " + state.placeLabel);
      updateSourceUI();

      setLoading(true);

      try{
        const data = await fetchWeather(lat, lon, state.units);
        const cur = data.current || {};
        const temp = cur.temperature_2m;
        const feels = cur.apparent_temperature;
        const wind = cur.wind_speed_10m;

        renderResult(temp, feels, wind);
      }catch(e){
        bigWord.textContent = "MAYBE";
        oneLiner.textContent = "Weather fetch failed. The hoodie gods are silent.";
        showToast("Could not fetch weather. Try again.");
      }
    }

    async function tryAutoLocation(){
      state.source = "auto";
      state.placeLabel = "Near you";
      setPill("Near you");
      updateSourceUI();
      setLoading(true);

      if (!navigator.geolocation){
        bigWord.textContent = "MAYBE";
        oneLiner.textContent = "No GPS here. Type a city and weâ€™ll judge it anyway.";
        return;
      }

      setPill("", { loading: true });

      const opts = { enableHighAccuracy: false, timeout: 8000, maximumAge: 120000 };

      navigator.geolocation.getCurrentPosition(async (pos) => {
        try{
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const rev = await reverseGeocode(lat, lon);
          await updateWeatherFromLatLon(lat, lon, rev.label, rev.countryCode, "gps");
        }catch(err){
          setPill("Near you");
          bigWord.textContent = "MAYBE";
          oneLiner.textContent = "Couldnâ€™t resolve your city. Type one and weâ€™ll be dramatic about it.";
          showToast("Location lookup failed");
        }
      }, (err) => {
        setPill("Near you");
        bigWord.textContent = "MAYBE";
        oneLiner.textContent = "No location, no problem. Type a place and letâ€™s argue about hoodies.";
        if (err && err.code === 1) showToast("Location access denied");
        else showToast("GPS error or timeout");
      }, opts);
    }

    async function onUseGPS(){
      if (!navigator.geolocation){
        showToast("No GPS available in this browser.");
        return;
      }
      state.source = "gps";
      setPill("", { loading: true });
      updateSourceUI();

      const opts = { enableHighAccuracy: true, timeout: 9000, maximumAge: 0 };

      navigator.geolocation.getCurrentPosition(async (pos) => {
        try{
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const rev = await reverseGeocode(lat, lon);
          await updateWeatherFromLatLon(lat, lon, rev.label, rev.countryCode, "gps");
        }catch(e){
          setPill("Near you");
          showToast("Could not resolve your city");
        }
      }, (err) => {
        setPill("Near you");
        if (err && err.code === 1) showToast("Location access denied");
        else showToast("GPS error or timeout");
      }, opts);
    }

    const globeSpins = [
      { label: "ReykjavÃ­k, Iceland", lat: 64.1466, lon: -21.9426, cc:"IS" },
      { label: "London, UK", lat: 51.5072, lon: -0.1276, cc:"GB" },
      { label: "Tokyo, Japan", lat: 35.6762, lon: 139.6503, cc:"JP" },
      { label: "Sydney, Australia", lat: -33.8688, lon: 151.2093, cc:"AU" },
      { label: "Mexico City, Mexico", lat: 19.4326, lon: -99.1332, cc:"MX" },
      { label: "Toronto, Canada", lat: 43.6532, lon: -79.3832, cc:"CA" },
      { label: "Chicago, IL", lat: 41.8781, lon: -87.6298, cc:"US" },
      { label: "Las Vegas, NV", lat: 36.1699, lon: -115.1398, cc:"US" },
      { label: "Paris, France", lat: 48.8566, lon: 2.3522, cc:"FR" }
    ];

    async function onSpinGlobe(){
      const pick = globeSpins[Math.floor(Math.random() * globeSpins.length)];
      state.source = "globe";
      await updateWeatherFromLatLon(pick.lat, pick.lon, pick.label, pick.cc, "globe");
    }

    async function onManualCommit(){
      const q = (manualInput.value || "").trim();
      if (!q){
        showToast("Type a city or ZIP first.");
        return;
      }

      try{
        const g = await geocodeDisplayName(q);
        state.source = "manual";
        await updateWeatherFromLatLon(g.lat, g.lon, g.label, g.countryCode, "manual");
      }catch(e){
        showToast("No results. Try a slightly different spelling.");
      }
    }

    runSelect.addEventListener("change", () => {
      state.run = runSelect.value;
      if (Number.isFinite(state.lat) && Number.isFinite(state.lon) && Number.isFinite(state.last.temp)){
        renderResult(state.last.temp, state.last.feels, state.last.wind);
      }
    });

    manualInput.addEventListener("input", () => {
      suggestLocations(manualInput.value).catch(() => {});
    });

    manualInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        onManualCommit();
      }
    });

    spinBtn.addEventListener("click", onSpinGlobe);
    gpsBtn.addEventListener("click", onUseGPS);

    brandHome.addEventListener("click", () => {
      manualInput.value = "";
      locList.innerHTML = "";
      tryAutoLocation();
    });

    (function init(){
      state.run = runSelect.value;
      updateSourceUI();
      tryAutoLocation();
    })();
  </script>
</body>
</html>
```

