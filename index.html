<!doctype html>
<html lang="en" class="theme-dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoodie or Nah</title>
  <meta name="description" content="Settle the hoodie debate. Hoodie judgment, delivered." />
  <meta name="theme-color" content="#0b0b0f" />

  <!-- Favicons / App Icons -->
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" href="/favicon-32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16.png" sizes="16x16" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
  <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />

  <!-- Open Graph / Social Sharing -->
  <meta property="og:title" content="Hoodie or Nah?" />
  <meta property="og:description" content="Settle the hoodie debate in one click based on the weather." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://hoodieornah.com" />
  <meta property="og:image" content="https://hoodieornah.com/og.png" />

  <style>
    :root{
      --bg:#0b0b0f;
      --panel: rgba(255,255,255,.04);
      --panel2: rgba(255,255,255,.03);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.76);
      --muted2: rgba(255,255,255,.64);
      --accent: rgba(255,255,255,.95);
      --shadow: 0 18px 45px rgba(0,0,0,.55);
      --shadow2: 0 10px 25px rgba(0,0,0,.45);
      --radius: 22px;
      --radius2: 16px;
    }
	    .theme-light{
      --bg:#eef1f7;
      --panel: rgba(255,255,255,.82);
      --panel2: rgba(255,255,255,.70);
      --stroke: rgba(0,0,0,.16);
      --text: rgba(15,15,25,.92);
      --muted: rgba(20,20,30,.72);
      --muted2: rgba(20,20,30,.62);
      --accent: rgba(10,10,20,.92);
      --shadow: 0 18px 45px rgba(0,0,0,.18);
      --shadow2: 0 10px 25px rgba(0,0,0,.15);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 520px at 20% 10%, rgba(255,255,255,.07), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 520px at 40% 90%, rgba(255,255,255,.05), transparent 65%),
        var(--bg);
      color: var(--text);
      overflow-x:hidden;
      transition: background .25s ease, color .25s ease;
    }

    .wrap{
      max-width: 1220px;
      margin: 18px auto 28px;
      padding: 0 18px 26px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 14px 18px;
      border: 1px solid var(--stroke);
      border-radius: 999px;
      background: linear-gradient(to bottom, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
      position: sticky;
      top: 10px;
      backdrop-filter: blur(14px);
      z-index: 50;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 260px;
      cursor:pointer;
      user-select:none;
    }
	    .brand .mark{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(255,255,255,.14), transparent 60%),
        rgba(255,255,255,.04);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 25px rgba(0,0,0,.45);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }

    .theme-light .brand .mark{
      border-color: rgba(0,0,0,.10);
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(0,0,0,.07), transparent 60%),
        rgba(0,0,0,.03);
      box-shadow: 0 10px 25px rgba(0,0,0,.10);
    }

    .brand:hover .mark{
      transform: translateY(-1px) scale(1.02);
      filter: drop-shadow(0 0 12px rgba(255,255,255,.10));
    }

    .brand .word{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }

    .brand .word strong{
      font-size: 18px;
      letter-spacing: .01em;
    }
    .brand .word span{
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .02em;
    }

    .controls{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    /* Unified pill heights */
    .pill,
    .seg button,
    .theme-toggle{
      min-height: 38px;
      line-height: 1;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 9px 12px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
      user-select:none;
      white-space: nowrap;
      transition: background .16s ease, border-color .16s ease, transform .16s ease;
    }
    .pill:hover{ background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.18); transform: translateY(-1px); }
    .pill[aria-pressed="true"]{ background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.22); }
	    .seg{
      display:flex;
      align-items:center;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
    }
    .seg button{
      border:0;
      background:transparent;
      color: var(--muted);
      padding: 9px 12px;
      font-size: 13px;
      cursor:pointer;
      transition: background .16s ease, color .16s ease;
    }
    .seg button:hover{ background: rgba(255,255,255,.05); color: var(--text); }
    .seg button[aria-pressed="true"]{ background: rgba(255,255,255,.08); color: var(--text); }

    /* theme toggle */
    .theme-toggle{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 9px 12px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 999px;
      background: rgba(255,255,255,.03);
      user-select:none;
      cursor:pointer;
      transition: background .16s ease, border-color .16s ease, transform .16s ease;
      font-size: 13px;
      color: var(--text);
    }
    .theme-toggle:hover{ background: rgba(255,255,255,.05); border-color: rgba(255,255,255,.18); transform: translateY(-1px); }
    .theme-switch{
      width: 36px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      position: relative;
      flex: 0 0 auto;
      transition: background .16s ease, border-color .16s ease;
    }
    .theme-switch::after{
      content:"";
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      position:absolute;
      top: 2px;
      left: 2px;
      transition: transform .16s ease, background .16s ease;
    }
    .theme-toggle[aria-pressed="true"] .theme-switch{
      background: rgba(255,255,255,.12);
      border-color: rgba(255,255,255,.22);
    }
    .theme-toggle[aria-pressed="true"] .theme-switch::after{
      transform: translateX(12px);
    }
	    .main{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1.25fr .95fr;
      gap: 14px;
    }

    @media (max-width: 980px){
      .brand{ min-width: unset; }
      .main{ grid-template-columns: 1fr; }
    }

    .card{
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius);
      background: linear-gradient(to bottom, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(420px 220px at 20% 0%, rgba(255,255,255,.07), transparent 60%);
      pointer-events:none;
    }

    .card-inner{ position:relative; padding: 18px; }

    .bigword{
      font-size: 72px;
      font-weight: 900;
      letter-spacing: .02em;
      margin: 6px 0 4px;
      line-height: .9;
    }

    .oneliner{
      color: var(--muted);
      font-size: 15px;
      margin: 0 0 16px;
      max-width: 560px;
    }

    .statrow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .stat{
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius2);
      background: rgba(0,0,0,.12);
      padding: 12px 12px;
      min-height: 70px;
    }

    .stat small{ display:block; color: var(--muted2); font-size:12px; margin-bottom: 6px; }
    .stat strong{ display:block; font-size: 15px; }
    .stat .sub{ margin-top: 4px; color: var(--muted2); font-size: 12px; }
	    /* Forecast: force 5 cards on desktop, no wrap, no scroll */
    .forecast{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(5, minmax(140px, 1fr));
      gap: 10px;
      overflow: visible;
      padding-bottom: 0;
    }
    @media (max-width: 900px){
      .forecast{ grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
    }
    .forecast-item{
      scroll-snap-align: start;
      min-width: 0;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      background: rgba(0,0,0,.12);
      padding: 12px 12px;
      cursor:pointer;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
      outline: none;
    }
    .forecast-item:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.20);
    }
    .forecast-item:focus-visible{ box-shadow: 0 0 0 3px rgba(255,255,255,.14); }
    .forecast-item.selected{ border-color: rgba(255,255,255,.26); background: rgba(255,255,255,.09); }

    .forecast-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
    }
    .forecast-top b{ font-size: 13px; }
    .forecast-top svg{ width: 26px; height: 26px; opacity: .98; color: var(--accent); }
    .forecast-mid{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted);
    }
    .forecast-mid strong{ color: var(--text); font-size: 14px; display:block; margin-top: 4px; }
    .forecast-line{
      margin-top: 8px;
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.25;
      min-height: 34px;
    }

    .left-footer{
      margin-top: 16px;
      display:block;
    }
    .cta{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      margin-top: 12px;
    }
	    .how-decided{
      margin-top: 10px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.4;
      max-width: 620px;
      padding: 8px 10px;
      border-radius: 10px;
      background: var(--panel2);
      border: 1px solid var(--stroke);
    }
    .how-decided b{ color: var(--text); font-weight: 800; }

    /* What to wear section */
    .wear-box{
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(0,0,0,.12);
      color: var(--text);
    }
    .wear-title{
      font-size: 13px;
      font-weight: 820;
      margin-bottom: 6px;
      color: var(--text);
    }
    .wear-list{
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
    }
    .wear-list li::before{
      content:"â€¢ ";
      color: var(--muted2);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      color: var(--text);
      font-size: 13px;
      cursor:pointer;
      text-decoration:none;
      transition: transform .16s ease, background .16s ease, border-color .16s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .btn.secondary{ background: rgba(0,0,0,.10); }
    .btn.secondary:hover{ background: rgba(255,255,255,.07); }

    .right-card h2{
      margin: 0;
      font-size: 22px;
      letter-spacing: .01em;
    }
    .right-card .subhead{
      margin-top: 6px;
      color: var(--muted);
      font-size: 13px;
    }
	    label{ display:block; margin-top: 12px; color: var(--muted2); font-size: 12px; letter-spacing: .02em; }
    select, input{
      width:100%;
      margin-top: 6px;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 14px;
      transition: border-color .16s ease, background .16s ease;
    }
    input::placeholder{ color: rgba(255,255,255,.38); }
    input:focus, select:focus{
      border-color: rgba(255,255,255,.24);
      background: rgba(0,0,0,.26);
    }
    select option{
      background: #0b0b0f;
      color: rgba(255,255,255,.92);
    }

    .form-row{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .form-row .btn{ flex: 1 1 auto; min-width: 160px; }

    .details{
      margin-top: 14px;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      background: rgba(0,0,0,.14);
      overflow:hidden;
    }
    .details-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .details-header b{ font-size: 13px; }

    .details-body{ padding: 12px; }
    .details-title{ font-size:16px; font-weight:800; color:var(--text); }
    .details-meta{ color:var(--muted); font-size:13px; display:flex; align-items:center; gap:8px; }
    .details-meta svg{ width:34px; height:34px; flex:0 0 auto; color: var(--accent); }
	    .ataglance{
      margin-top: 10px;
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .ataglance .chip{
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      color: var(--text);
      background: rgba(255,255,255,.10);
    }

    .sunrow{ width:100%; margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .sunbox{ border:1px solid rgba(255,255,255,.14); border-radius:14px; padding:10px 12px; background: rgba(255,255,255,.06); }
    .sunlabel{ display:block; font-size:12px; color:var(--muted); letter-spacing:.02em; }
    .sunvalue{ display:block; margin-top:2px; font-size:14px; font-weight:700; color:var(--text); }

    .site-footer{
      margin-top: 14px;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      padding: 14px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.3;
      flex-wrap: wrap;
    }
    .site-footer a{ color: rgba(255,255,255,.85); text-decoration:none; border-bottom: 1px solid rgba(255,255,255,.20); }
    .site-footer a:hover{ border-bottom-color: rgba(255,255,255,.40); }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(10,10,14,.88);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 999px;
      padding: 10px 14px;
      color: rgba(255,255,255,.92);
      box-shadow: var(--shadow2);
      opacity: 0;
      pointer-events:none;
      transition: opacity .20s ease, transform .20s ease;
      z-index: 120;
      font-size: 13px;
      max-width: 92vw;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-6px); }

    .spinner{
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.22);
      border-top-color: rgba(255,255,255,.85);
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
	        const lon = pos.coords.longitude;

        await updateWeatherFromLatLon(lat, lon, "Near you", null, "auto", { forceSelectFirst: true });

        try{
          const got = await reverseGeocodeToLabel(lat, lon);
          if (got && got.label){
            state.placeLabel = got.label;
            state.countryCode = got.cc || state.countryCode;
            setPill(state.placeLabel);
            updateSourceUI();
            saveState();

            if (!state.unitOverride && got.cc){
              const newUnits = countryUsesF(got.cc) ? "F" : "C";
              if (newUnits !== state.units){
                state.units = newUnits;
                setUnitControlButtons();
                saveState();
                setLoadingUI();
                await updateWeatherFromLatLon(lat, lon, state.placeLabel, state.countryCode, "auto", { forceSelectFirst: true });
              }
            }
          } else {
            setPill("Near you");
          }
        }catch(e){
          setPill("Near you");
        }

      }, () => {
        setPill("Near you");
        endLoadingUI();
      }, opts);
    }

    async function onUseGPS(){
      if (!navigator.geolocation){ showToast("No GPS available in this browser."); return; }
      state.source = "gps";
      updateSourceUI();
      setPill("Locating...");
      setLoadingUI();

      const opts = { enableHighAccuracy: true, timeout: 8000, maximumAge: 120000 };
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        let label = "Near you";
        let cc = null;

        try{
          const got = await reverseGeocodeToLabel(lat, lon);
          if (got && got.label) label = got.label;
          if (got && got.cc) cc = got.cc;
        }catch(e){}

        await updateWeatherFromLatLon(lat, lon, label, cc, "gps", { forceSelectFirst: true });

      }, (err) => {
        endLoadingUI();
        setPill(state.placeLabel || "Near you");
        updateSourceUI();
        if (err && err.code === 1) showToast("Location access denied");
        else showToast("Could not get GPS. Try manual.");
      }, opts);
    }

    async function onSpinGlobe(){
      state.source = "globe";
      updateSourceUI();
      setLoadingUI();

      const idx = popNextSpinIndex();
      const spot = CURATED_CITIES[idx] || CURATED_CITIES[0];

      state.placeLabel = spot.label;
      state.countryCode = spot.cc;
      setPill(spot.label);
      saveState();

      await updateWeatherFromLatLon(spot.lat, spot.lon, spot.label, spot.cc, "globe", { forceSelectFirst: true });
    }

    function clearDatalist(){
      el.locList.innerHTML = "";
    }

    async function refreshSuggestions(q){
      const seq = ++suggestSeq;
      if (!q || q.trim().length < 2) { clearDatalist(); return; }

      try{
        const results = await geocodeDisplayName(q.trim());
        if (seq !== suggestSeq) return;

        clearDatalist();
        results.slice(0, 6).forEach(r => {
          const opt = document.createElement("option");
          opt.value = r.label;
          el.locList.appendChild(opt);
        });
      }catch(e){
        if (seq !== suggestSeq) return;
        clearDatalist();
      }
    }

    async function applyManualSelection(text){
      const q = (text || "").trim();
      if (!q) return;

      setLoadingUI();
      state.source = "manual";
      updateSourceUI();

      try{
        const results = await geocodeDisplayName(q);
        const best = results[0];
        if (!best) throw new Error("no_results");

        state.placeLabel = best.label;
        state.countryCode = best.countryCode || state.countryCode;
        setPill(best.label);

        await updateWeatherFromLatLon(best.lat, best.lon, best.label, best.countryCode, "manual", { forceSelectFirst: true });

        clearDatalist();
        el.manualInput.blur();
      }catch(e){
        endLoadingUI();
        showToast("No results. Try another spelling.");
      } finally {
        saveState();
      }
    }

    function loadTheme(){
      try{
        const saved = localStorage.getItem("hoodieornah_theme_v1");
        if (saved === "light" || saved === "dark") return saved;
      }catch(e){}
      return "dark";
    }
    function saveTheme(t){
      try{ localStorage.setItem("hoodieornah_theme_v1", t); }catch(e){}
    }
    function applyTheme(t){
      theme = t === "light" ? "light" : "dark";
      const root = document.documentElement;
      root.classList.remove("theme-light","theme-dark");
      root.classList.add(theme === "light" ? "theme-light" : "theme-dark");
      el.themeToggle.setAttribute("aria-pressed", theme === "light" ? "true" : "false");
      el.themeLabel.textContent = theme === "light" ? "Light" : "Dark";
      saveTheme(theme);
    }
	    function wireEvents(){
      el.unitAuto.addEventListener("click", async () => {
        state.unitOverride = null;
        if (state.countryCode){
          state.units = countryUsesF(state.countryCode) ? "F" : "C";
        }
        setUnitControlButtons();
        updateSourceUI();
        saveState();

        if (state.lat != null && state.lon != null){
          setLoadingUI();
          await updateWeatherFromLatLon(state.lat, state.lon, state.placeLabel, state.countryCode, state.source, { forceSelectFirst: true });
        }
      });

      el.unitF.addEventListener("click", async () => {
        state.unitOverride = "F";
        setUnitControlButtons();
        updateSourceUI();
        saveState();

        if (state.lat != null && state.lon != null){
          setLoadingUI();
          await updateWeatherFromLatLon(state.lat, state.lon, state.placeLabel, state.countryCode, state.source, { forceSelectFirst: true });
        }
      });

      el.unitC addEventListener("click", async () => {
        state.unitOverride = "C";
        setUnitControlButtons();
        updateSourceUI();
        saveState();

        if (state.lat != null && state.lon != null){
          setLoadingUI();
          await updateWeatherFromLatLon(state.lat, state.lon, state.placeLabel, state.countryCode, state.source, { forceSelectFirst: true });
        }
      });

      el.runSelect.addEventListener("change", async () => {
        state.run = el.runSelect.value;
        saveState();

        if (state.lat != null && state.lon != null){
          setLoadingUI();
          await updateWeatherFromLatLon(state.lat, state.lon, state.placeLabel, state.countryCode, state.source, { forceSelectFirst: true });
        }
      });

      el.spinBtn.addEventListener("click", onSpinGlobe);
      el.gpsBtn.addEventListener("click", onUseGPS);

      el.brandHome.addEventListener("click", async () => {
        setLoadingUI();
        await tryAutoLocation();
      });

      el.forecastList.addEventListener("click", (e) => {
        const item = e.target && e.target.closest ? e.target.closest(".forecast-item") : null;
        if (!item) return;
        selectForecastIndex(item.dataset.idx);
      });
      el.forecastList.addEventListener("keydown", (e) => {
        if (e.key !== "Enter" && e.key !== " ") return;
        const item = e.target && e.target.classList && e.target.classList.contains("forecast-item") ? e.target : null;
        if (!item) return;
        e.preventDefault();
        selectForecastIndex(item.dataset.idx);
      });

      el.manualInput.addEventListener("input", () => {
        const q = el.manualInput.value || "";
        clearTimeout(suggestTimer);
        suggestTimer = setTimeout(() => refreshSuggestions(q), 180);
      });

      el.manualInput.addEventListener("change", () => {
        applyManualSelection(el.manualInput.value);
      });

      el.manualInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter"){
          e.preventDefault();
          applyManualSelection(el.manualInput.value);
        }
      });

      el.wherePill.addEventListener("click", () => {
        const d = el.detailsDrawer;
        if (d && typeof d.scrollIntoView === "function"){
          d.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });

      el.themeToggle.addEventListener("click", () => {
        applyTheme(theme === "dark" ? "light" : "dark");
      });
      el.themeToggle.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); el.themeToggle.click(); }
      });
    }

    async function init(){
      el.runSelect.value = state.run || "normal";
      setUnitControlButtons();
      setPill(state.placeLabel || "Near you");
      updateSourceUI();
      applyTheme(theme);
      wireEvents();

      if (state.lat != null && state.lon != null && state.source && state.source !== "auto"){
        setLoadingUI();
        await updateWeatherFromLatLon(state.lat, state.lon, state.placeLabel, state.countryCode, state.source, { forceSelectFirst: true });
        return;
      }

      await tryAutoLocation();
    }

    init();
  </script>
</body>
</html>
