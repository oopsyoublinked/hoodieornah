<!doctype html>
<html lang="en" class="theme-light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hoodie or Nah</title>
  <meta name="description" content="Settle the hoodie debate. Hoodie judgment, delivered." />
  <meta name="theme-color" content="#667eea" />
  <link rel="manifest" href="/manifest.json" />
  
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" href="/favicon-32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16.png" sizes="16x16" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192" />
  <link rel="icon" type="image/png" href="/android-chrome-512x512.png" sizes="512x512" />
  
  <meta property="og:title" content="Hoodie or Nah?" />
  <meta property="og:description" content="Settle the hoodie debate in one click based on the weather." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://hoodieornah.com" />
  <meta property="og:image" content="https://hoodieornah.com/og.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Hoodie or Nah?" />
  <meta name="twitter:description" content="Settle the daily hoodie debate." />
  <meta name="twitter:image" content="https://hoodieornah.com/og.png" />

  <style>
    /* ========== HYBRID DESIGN SYSTEM ========== */
    :root {
      /* Backgrounds */
      --bg-gradient: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #FFE4B5 100%);
      
      /* Core colors */
      --white: #ffffff;
      --black: #1a1a1a;
      --gray-50: #fafaf9;
      --gray-100: #f5f5f4;
      --gray-200: #e7e5e4;
      --gray-300: #d6d3d1;
      --gray-400: #a8a29e;
      --gray-500: #78716c;
      --gray-600: #57534e;
      --gray-700: #44403c;
      
      /* Gradients */
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      
      /* Spacing */
      --space-xs: 8px;
      --space-sm: 12px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;
      
      /* Radius */
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 24px;
      --radius-xl: 32px;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.2);
      
      /* Legacy compatibility */
      --bg: #87CEEB;
      --panel: rgba(255,255,255,.95);
      --panel2: rgba(255,255,255,.90);
      --stroke: rgba(0,0,0,.08);
      --text: #1a1a1a;
      --muted: #666;
      --muted2: #999;
      --accent: #667eea;
      --shadow: var(--shadow-lg);
      --shadow2: var(--shadow-md);
      --radius: var(--radius-lg);
      --radius2: var(--radius-md);
    }
    
    .theme-dark {
      --bg-gradient: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      --white: #1a1a1a;
      --black: #ffffff;
      --gray-50: #292524;
      --gray-100: #1c1917;
      --gray-200: rgba(255,255,255,.1);
      --gray-300: rgba(255,255,255,.15);
      --gray-600: rgba(255,255,255,.7);
      --gray-700: rgba(255,255,255,.85);
      --panel: rgba(30,30,40,.95);
      --panel2: rgba(40,40,50,.90);
      --stroke: rgba(255,255,255,.1);
      --text: #ffffff;
      --muted: rgba(255,255,255,.7);
      --muted2: rgba(255,255,255,.5);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow-x: hidden; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-gradient);
      color: var(--black);
      -webkit-font-smoothing: antialiased;
    }
    
    .wrap {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-lg);
    }
    
    /* ========== TOPBAR ========== */
    .topbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: var(--radius-xl);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
      flex-wrap: wrap;
      position: relative;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s;
      min-width: unset;
    }
    
    .brand:hover {
      transform: translateY(-2px);
    }
    
    .brand .mark {
      width: 56px;
      height: 56px;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      display: grid;
      place-items: center;
      box-shadow: var(--shadow-md);
      border: none;
      transition: transform 0.2s;
    }
    
    .brand .mark img {
      width: 32px;
      height: 32px;
      display: block;
    }
    
    .brand:hover .mark {
      transform: scale(1.05);
    }
    
    .brand .word {
      display: flex;
      flex-direction: column;
      line-height: 1.05;
    }
    
    .brand .word strong {
      font-size: 20px;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.01em;
    }
    
    .brand .word span {
      font-size: 12px;
      color: var(--gray-600);
      letter-spacing: 0.02em;
      margin-top: 2px;
    }
    
    .controls {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-wrap: wrap;
      flex: 1 1 auto;
    }
    
    /* Icon buttons (refresh, theme) */
    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-full);
      border: 2px solid var(--gray-200);
      background: var(--white);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 20px;
    }
    
    .icon-btn:hover {
      background: var(--gray-50);
      border-color: var(--gray-300);
      transform: translateY(-2px);
    }
    
    /* Pills for units and location */
    .pillrow {
      display: flex;
      gap: var(--space-xs);
      align-items: center;
      padding: 4px;
      border-radius: var(--radius-full);
      background: var(--gray-100);
      flex-wrap: nowrap;
    }
    
    .seg {
      display: inline-flex;
      align-items: stretch;
      border-radius: var(--radius-full);
      overflow: hidden;
      background: var(--gray-100);
      flex: 0 1 auto;
      padding: 4px;
      gap: 4px;
    }
    
    .seg button {
      border: 0;
      background: transparent;
      color: var(--gray-600);
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border-radius: var(--radius-full);
      min-width: 60px;
    }
    
    .seg button:hover {
      background: rgba(0,0,0,.05);
      color: var(--black);
    }
    
    .seg button[aria-pressed="true"] {
      background: var(--white);
      color: var(--black);
      box-shadow: var(--shadow-sm);
    }
    
    .pill {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 10px 20px;
      background: var(--gradient-primary);
      color: white;
      border-radius: var(--radius-full);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-md);
      border: none;
      flex: 1 1 180px;
      justify-content: center;
    }
    
    .pill:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    /* ========== MAIN LAYOUT ========== */
    .main {
      display: grid;
      grid-template-columns: 1.25fr .95fr;
      gap: var(--space-lg);
      align-items: start;
      margin-top: var(--space-md);
    }
    
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      position: relative;
      border: 2px solid rgba(0,0,0,.06);
    }
    
    .card.loading {
      opacity: 0.8;
    }
    
    .card-inner {
      position: relative;
      padding: var(--space-xl);
      min-height: 100%;
    }
    
    /* ========== HERO VERDICT (leftCard) ========== */
    #leftCard {
      grid-column: 1;
    }
    
    #leftCard::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.08) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
      pointer-events: none;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .bigword {
      font-size: 140px;
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 0.9;
      margin: var(--space-md) 0;
      position: relative;
      z-index: 1;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
    }
    
    .bigword.verdict-HOODIE {
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .bigword.verdict-PARKA {
      background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .bigword.verdict-MAYBE {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .bigword.verdict-NAH {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    @keyframes verdictReveal {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    .bigword.reveal {
      animation: verdictReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* RIGHT NOW badge */
    #leftCard .card-inner > div:first-child {
      display: inline-block;
      padding: 8px 20px;
      background: rgba(102, 126, 234, 0.12);
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: var(--radius-full);
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #667eea;
      margin-bottom: var(--space-md);
      position: relative;
      z-index: 1;
    }
    
    .oneliner {
      font-size: 20px;
      color: var(--gray-600);
      max-width: 600px;
      margin: 0 0 var(--space-lg);
      line-height: 1.5;
      position: relative;
      z-index: 1;
    }
    
    .statrow {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
      margin-top: var(--space-lg);
      position: relative;
      z-index: 1;
    }
    
    .stat {
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 0, 0, 0.06);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      min-height: 70px;
    }
    
    .stat small {
      display: block;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-500);
      margin-bottom: var(--space-xs);
    }
    
    .stat strong {
      display: block;
      font-size: 20px;
      font-weight: 800;
      color: var(--black);
    }
    
    .stat .sub {
      margin-top: var(--space-xs);
      color: var(--gray-600);
      font-size: 13px;
    }
    
    /* ========== FORECAST SECTION ========== */
    .forecast {
      margin-top: var(--space-lg);
      display: flex;
      gap: var(--space-md);
      overflow-x: auto;
      overflow-y: visible;
      padding: var(--space-sm) var(--space-sm) var(--space-lg);
      margin: var(--space-lg) calc(var(--space-lg) * -1) var(--space-lg);
      scrollbar-width: thin;
      scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
      position: relative;
      z-index: 1;
    }
    
    .forecast::-webkit-scrollbar {
      height: 8px;
    }
    
    .forecast::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .forecast::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: var(--radius-full);
    }
    
    .forecast-item {
      min-width: 180px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(0, 0, 0, 0.08);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: var(--shadow-md);
      user-select: none;
      outline: none;
    }
    
    .forecast-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: var(--shadow-xl);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .forecast-item.selected {
      background: var(--gradient-primary);
      color: white;
      border-color: transparent;
      transform: translateY(-4px);
    }
    
    .forecast-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-xs);
      margin-bottom: var(--space-md);
    }
    
    .forecast-top b {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: normal;
      line-height: 1.2;
    }
    
    .forecast-top svg {
      width: 24px;
      height: 24px;
      opacity: 0.98;
      flex: 0 0 auto;
    }
    
    .forecast-mid {
      margin-top: var(--space-md);
      font-size: 12px;
    }
    
    .forecast-mid strong {
      font-size: 32px;
      font-weight: 800;
      display: block;
      margin: var(--space-sm) 0;
    }
    
    .forecast-line {
      margin-top: var(--space-sm);
      font-size: 12px;
      opacity: 0.8;
      line-height: 1.25;
      min-height: 34px;
    }
    
    .forecast-item.selected .forecast-top b,
    .forecast-item.selected .forecast-mid,
    .forecast-item.selected .forecast-line {
      color: white;
    }
    
    /* ========== FORM CARD (rightCard) ========== */
    #rightCard {
      grid-column: 2;
    }
    
    #rightCard h2 {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: var(--space-lg);
      color: var(--black);
    }
    
    .subhead {
      margin-top: 6px;
      color: var(--gray-600);
      font-size: 13px;
    }
    
    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-600);
      margin: var(--space-lg) 0 var(--space-xs);
    }
    
    select, input {
      width: 100%;
      padding: 14px 18px;
      background: var(--gray-50);
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-md);
      font-size: 15px;
      font-family: inherit;
      color: var(--black);
      transition: all 0.2s;
      margin-top: 6px;
    }
    
    select:hover, input:hover {
      border-color: var(--gray-300);
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      background: var(--white);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }
    
    input::placeholder {
      color: var(--gray-400);
    }
    
    select option {
      background: var(--white);
      color: var(--black);
    }
    
    .form-row {
      margin-top: var(--space-md);
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
      justify-content: stretch;
    }
    
    .form-row .btn {
      flex: 1 1 0;
      min-width: 0;
    }
    
    .btn {
      padding: 14px 20px;
      background: var(--gradient-primary);
      border: none;
      border-radius: var(--radius-md);
      color: white;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--shadow-md);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .btn.secondary {
      background: var(--white);
      color: var(--black);
      border: 2px solid var(--gray-200);
      box-shadow: var(--shadow-sm);
    }
    
    .btn.secondary:hover {
      border-color: var(--gray-300);
      background: var(--gray-50);
    }
    
    /* Info boxes */
    .info-box {
      padding: var(--space-md);
      background: rgba(102, 126, 234, 0.08);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: var(--radius-md);
      margin-top: var(--space-lg);
    }
    
    .info-box-title {
      font-size: 12px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: var(--space-xs);
    }
    
    .info-box-content {
      font-size: 13px;
      line-height: 1.5;
      color: var(--gray-700);
    }
    
    .threshold-grid {
      display: grid;
      gap: 6px;
      font-size: 12px;
      margin-top: var(--space-sm);
    }
    
    .threshold-item {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }
    
    .threshold-temp {
      font-weight: 700;
      min-width: 80px;
    }
    
    /* ========== DETAILS CARD ========== */
    .details-card {
      grid-column: 1 / -1;
    }
    
    .details {
      border-radius: var(--radius-lg);
      background: rgba(0,0,0,.02);
      overflow: hidden;
    }
    
    .details-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-md);
      border-bottom: 2px solid rgba(0,0,0,.05);
    }
    
    .details-header b {
      font-size: 14px;
      font-weight: 700;
      color: var(--black);
    }
    
    .details-body {
      padding: var(--space-lg);
    }
    
    .details-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--black);
    }
    
    .details-meta {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin: var(--space-md) 0;
    }
    
    .details-meta svg,
    .details-meta span[id$="Icon"] {
      font-size: 48px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
    }
    
    .ataglance {
      margin-top: var(--space-md);
      display: flex;
      gap: var(--space-xs);
      flex-wrap: wrap;
    }
    
    .ataglance .chip {
      padding: 8px 16px;
      background: var(--gray-100);
      border-radius: var(--radius-full);
      font-size: 13px;
      font-weight: 600;
      color: var(--gray-700);
      border: 2px solid var(--gray-200);
    }
    
    .sunrow {
      width: 100%;
      margin-top: var(--space-lg);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-md);
    }
    
    .sunbox {
      background: var(--gray-50);
      border: 2px solid var(--gray-100);
      border-radius: var(--radius-md);
      padding: var(--space-md);
    }
    
    .sunlabel {
      display: block;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-500);
      margin-bottom: var(--space-xs);
    }
    
    .sunvalue {
      display: block;
      margin-top: 2px;
      font-size: 20px;
      font-weight: 700;
      color: var(--black);
    }
    
    /* Hourly breakdown */
    .hourly-grid {
      display: grid;
      gap: var(--space-sm);
      margin: var(--space-md) 0;
    }
    
    .hourly-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md);
      background: var(--gray-50);
      border: 2px solid var(--gray-100);
      border-radius: var(--radius-md);
    }
    
    .hourly-time {
      flex: 1;
    }
    
    .hourly-period {
      font-size: 11px;
      color: var(--gray-500);
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .hourly-label {
      font-size: 14px;
      font-weight: 700;
      color: var(--black);
      margin-top: 2px;
    }
    
    .hourly-temp-verdict {
      text-align: right;
    }
    
    .hourly-temp {
      font-size: 18px;
      font-weight: 800;
      color: var(--black);
    }
    
    .hourly-verdict {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      margin-top: 4px;
    }
    
    /* Day tips */
    .tips-box {
      margin-top: var(--space-lg);
      padding: var(--space-md);
      background: var(--gray-50);
      border-left: 4px solid #667eea;
      border-radius: var(--radius-sm);
    }
    
    .tips-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--black);
      margin-bottom: var(--space-xs);
    }
    
    .tips-content {
      font-size: 13px;
      line-height: 1.6;
      color: var(--gray-600);
    }
    
    .tips-content div {
      margin-bottom: 4px;
    }
    
    /* ========== HOW DECIDED & WEAR BOX ========== */
    .how-decided {
      margin-top: var(--space-lg);
      color: var(--black);
      font-size: 13px;
      line-height: 1.4;
      max-width: 620px;
      padding: var(--space-md);
      border-radius: var(--radius-sm);
      background: rgba(0,0,0,.02);
      border: 2px solid rgba(0,0,0,.05);
      position: relative;
      z-index: 1;
    }
    
    .how-decided b {
      color: var(--black);
      font-weight: 800;
    }
    
    .wear-box {
      margin-top: var(--space-lg);
      background: rgba(102, 126, 234, 0.08);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      color: var(--black);
      position: relative;
      z-index: 1;
    }
    
    .wear-title {
      font-size: 14px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: var(--space-md);
    }
    
    .wear-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
      font-size: 14px;
      color: var(--gray-700);
      line-height: 1.8;
    }
    
    .wear-list li {
      position: relative;
      padding-left: 20px;
    }
    
    .wear-list li::before {
      content: "\2022";
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: 700;
    }
    
    .cta {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
      flex-wrap: wrap;
      margin-top: var(--space-lg);
      position: relative;
      z-index: 1;
    }
    
    /* ========== LOADING STATES ========== */
    .loading-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #667eea);
      background-size: 200% 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      z-index: 100;
    }
    
    .loading-bar.active {
      opacity: 1;
      animation: loadingSlide 1.5s ease-in-out infinite;
    }
    
    @keyframes loadingSlide {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }
    
    .loading-shimmer {
      opacity: 0.6;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 0.3; }
    }
    
    /* ========== TOAST ========== */
    .toast {
      position: fixed;
      bottom: var(--space-lg);
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(20px);
      color: white;
      padding: 14px 24px;
      border-radius: var(--radius-full);
      font-size: 14px;
      font-weight: 600;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 1000;
      max-width: 90vw;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* ========== FOOTER ========== */
    .site-footer {
      margin-top: var(--space-2xl);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-lg);
      color: var(--gray-600);
      font-size: 12px;
      line-height: 1.3;
      flex-wrap: wrap;
      border: 2px solid rgba(0,0,0,.06);
    }
    
    .site-footer a {
      color: var(--black);
      text-decoration: none;
      border-bottom: 1px solid var(--gray-300);
    }
    
    .site-footer a:hover {
      border-bottom-color: #667eea;
      color: #667eea;
    }
    
    .site-footer b {
      display: block;
      margin-bottom: var(--space-xs);
      color: var(--black);
      font-weight: 700;
    }
    
    /* ========== RESPONSIVE ========== */
    @media (max-width: 980px) {
      .brand { min-width: unset; }
      .main { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 720px) {
      .wrap {
        padding: var(--space-md);
        margin: var(--space-md) auto var(--space-lg);
      }
      
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
        border-radius: var(--radius-lg);
        position: static;
      }
      
      .brand {
        width: 100%;
        justify-content: flex-start;
      }
      
      .controls {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: var(--space-sm);
      }
      
      .pillrow {
        flex: 1 1 auto;
        flex-wrap: wrap;
        justify-content: flex-start;
        gap: var(--space-xs);
      }
      
      .seg {
        width: 100%;
        justify-content: space-between;
      }
      
      .seg button {
        flex: 1;
        padding: 8px 10px;
        font-size: 12px;
        min-width: 50px;
      }
      
      .pill {
        height: 42px;
        padding: 0 var(--space-md);
        font-size: 13px;
        max-width: 100%;
      }
      
      .main {
        margin-top: var(--space-md);
        gap: var(--space-md);
        display: flex;
        flex-direction: column;
      }
      
      .card {
        border-radius: var(--radius-lg);
      }
      
      .bigword {
        font-size: 90px;
      }
      
      .oneliner {
        font-size: 16px;
      }
      
      .forecast {
        grid-template-columns: 1fr;
        gap: var(--space-sm);
      }
      
      .forecast-item {
        padding: var(--space-md);
      }
      
      .cta .btn {
        width: 100%;
        justify-content: center;
      }
      
      .form-row {
        flex-direction: column;
      }
      
      .form-row .btn {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      .bigword {
        font-size: 72px;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .pillrow {
        width: 100%;
      }
      
      .pill {
        width: 100%;
        justify-content: center;
      }
      
      .statrow {
        grid-template-columns: 1fr;
      }
      
      .sunrow {
        grid-template-columns: 1fr;
      }
      
      .details .ataglance .chip {
        font-size: 11px;
        padding: 6px 12px;
      }
      
      .wear-box,
      .how-decided {
        font-size: 12px;
      }
    }
    
    /* ========== DARK MODE OVERRIDES ========== */
    .theme-dark .topbar,
    .theme-dark .card,
    .theme-dark .site-footer {
      background: rgba(30, 30, 40, 0.95);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .theme-dark .stat,
    .theme-dark .hourly-item,
    .theme-dark .sunbox,
    .theme-dark select,
    .theme-dark input {
      background: rgba(40, 40, 50, 0.6);
      border-color: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .theme-dark .chip {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
      border-color: rgba(255, 255, 255, 0.15);
    }
    
    .theme-dark .icon-btn {
      background: rgba(40, 40, 50, 0.8);
      border-color: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .theme-dark .seg {
      background: rgba(40, 40, 50, 0.8);
    }
    
    .theme-dark .seg button[aria-pressed="true"] {
      background: rgba(102, 126, 234, 0.3);
      color: white;
    }
    
    .theme-dark .forecast-item {
      background: rgba(40, 40, 50, 0.9);
      border-color: rgba(255, 255, 255, 0.1);
    }
    
    .theme-dark input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand" id="brandHome" title="Tap to refresh location">
        <div class="mark" aria-hidden="true">üëï</div>
        <div class="word">
          <strong>Hoodie or Nah</strong>
          <span>Hoodie judgment, delivered.</span>
        </div>
      </div>

      <div class="controls">
        <button class="icon-btn" id="themeBtn" title="Toggle theme">üåô</button>
        <button class="icon-btn" id="refreshBtn" title="Refresh">üîÑ</button>
        
        <div class="pillrow">
          <div class="seg" aria-label="Units">
            <button id="unitAuto" type="button" aria-pressed="true">Auto</button>
            <button id="unitF" type="button" aria-pressed="false">¬∞F</button>
            <button id="unitC" type="button" aria-pressed="false">¬∞C</button>
          </div>
          <div class="pill" id="wherePill" title="Jump to forecast details">
            <span aria-hidden="true">üìç</span>
            <span id="pillText">Near you</span>
          </div>
        </div>
      </div>
    </div>

    <div class="main" id="mainLayout">
      <div class="card" id="leftCard">
        <div class="loading-bar" id="loadingBar"></div>
        <div class="card-inner">
          <div style="display:inline-block; padding:4px 10px; border-radius:999px; background:rgba(102,126,234,.15); border:2px solid rgba(102,126,234,.3); font-size:11px; font-weight:700; letter-spacing:.02em; margin-bottom:8px; color:#667eea;">
            RIGHT NOW
          </div>
          <div class="bigword" id="bigWord">LOADING</div>
          <div class="oneliner" id="oneLiner">Fetching your weather so we can judge you properly.</div>

          <div class="statrow">
            <div class="stat">
              <small>Location</small>
              <strong id="locName">Near you</strong>
              <div class="sub" id="locSource">Source: auto</div>
              <span class="last-updated" id="lastUpdated"></span>
            </div>
            <div class="stat">
              <small>Right now</small>
              <strong id="nowTemp">--</strong>
              <div class="sub" id="nowSub">Feels like: -- | Wind: --</div>
            </div>
          </div>

          <div class="forecast" id="forecastList" aria-label="5 day forecast"></div>

          <div class="how-decided">
            <b>How we decided:</b> based on what it feels like RIGHT NOW (not the forecast), plus wind and how you run. Not your fashion sense.
          </div>

          <div class="wear-box">
            <div class="wear-title">What to wear</div>
            <ul class="wear-list" id="wearList">
              <li>Midweight hoodie; add a shell if wind is mouthy.</li>
              <li>Beanie or ear cover; gloves keep fingers opinionated.</li>
              <li>Closed shoes; skip shorts unless you like dramatic exits.</li>
            </ul>
          </div>

          <div class="cta">
            <button class="btn" id="shareBtn" type="button">Share verdict</button>
            <a class="btn" href="https://buymeacoffee.com/hoodieornah" target="_blank" rel="noopener">Support the hoodie science</a>
          </div>
        </div>
      </div>

      <div class="card" id="rightCard">
        <div class="card-inner">
          <h2>How do you run?</h2>
          <div class="subhead">Be honest. We can tell.</div>

          <label for="runSelect">Temperature preference</label>
          <select id="runSelect">
            <option value="normal">Normal</option>
            <option value="cold">I run cold</option>
            <option value="hot">I run hot</option>
          </select>

          <label for="manualInput">Manual location (optional)</label>
          <input id="manualInput" list="locList" placeholder="City, Region, Country or ZIP" autocomplete="off" />
          <datalist id="locList"></datalist>

          <div class="form-row">
            <button class="btn secondary" id="spinBtn" type="button">üåç Spin the globe</button>
            <button class="btn secondary" id="gpsBtn" type="button">üìç Use my GPS</button>
          </div>

          <div class="info-box">
            <div class="info-box-title">üí° VERDICT UPDATES LIVE</div>
            <div class="info-box-content">
              The main verdict changes based on current temperature. Check back throughout the day for updates!
            </div>
          </div>
          
          <div class="info-box">
            <div class="info-box-title">üå°Ô∏è THRESHOLD GUIDE</div>
            <div class="threshold-grid">
              <div class="threshold-item">
                <span class="threshold-temp" style="color: #818cf8;">‚â§25¬∞F</span>
                <span>Parka weather</span>
              </div>
              <div class="threshold-item">
                <span class="threshold-temp" style="color: #60a5fa;">26-50¬∞F</span>
                <span>Hoodie time</span>
              </div>
              <div class="threshold-item">
                <span class="threshold-temp" style="color: #fbbf24;">51-65¬∞F</span>
                <span>Maybe hoodie</span>
              </div>
              <div class="threshold-item">
                <span class="threshold-temp" style="color: #f87171;">‚â•66¬∞F</span>
                <span>Too warm</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card details-card" id="detailsCard">
        <div class="card-inner">
          <div class="details" id="detailsDrawer">
            <div class="details-header">
              <b>Forecast details</b>
              <span style="color:var(--muted2); font-size:12px;" id="detailsHint">Auto-filled for today</span>
            </div>
            <div class="details-body">
              <div class="details-title" id="detailsDay">--</div>

              <div class="details-meta" style="margin-top:8px;">
                <span id="detailsIcon" aria-hidden="true"></span>
                <span id="detailsSummary">--</span>
              </div>

              <div style="margin-top:10px; color:var(--muted); font-size:13px;">
                <b id="detailsDecision">--</b>
                <div id="detailsText" style="margin-top:4px;">--</div>
                <div style="margin-top:8px;">
                  High: <span id="detailsHigh">--</span> |
                  Low: <span id="detailsLow">--</span>
                </div>
              </div>

              <div class="ataglance" id="chipsRow"></div>

              <div class="sunrow">
                <div class="sunbox">
                  <span class="sunlabel">Sun up</span>
                  <span class="sunvalue" id="sunUp">--</span>
                </div>
                <div class="sunbox">
                  <span class="sunlabel">Sun down</span>
                  <span class="sunvalue" id="sunDown">--</span>
                </div>
              </div>
              
              <h3 style="font-size:14px; font-weight:700; margin:var(--space-lg) 0 var(--space-md); color:var(--black);">üïê Throughout the day</h3>
              <div class="hourly-grid" id="hourlyContent"></div>
              
              <div class="tips-box" id="dayTipsBox" style="display:none;">
                <div class="tips-title">üí≠ Day planning</div>
                <div class="tips-content" id="dayTipsContent"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="site-footer">
      <div>
        <b>Contact</b>
        <a href="mailto:info@hoodieornah.com">info@hoodieornah.com</a><br />
        We read it. Eventually.
      </div>
      <div style="max-width: 720px;">
        Weather data via Open-Meteo. Geocoding via OpenStreetMap Nominatim.<br />
        This site is for entertainment and mild arguments only. No warranties. Do not sue us because you wore a hoodie in a blizzard.
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const el = {
      brandHome: document.getElementById("brandHome"),
      leftCard: document.getElementById("leftCard"),
      rightCard: document.getElementById("rightCard"),
      detailsCard: document.getElementById("detailsCard"),
      unitAuto: document.getElementById("unitAuto"),
      unitF: document.getElementById("unitF"),
      unitC: document.getElementById("unitC"),
      wherePill: document.getElementById("wherePill"),
      pillText: document.getElementById("pillText"),

      bigWord: document.getElementById("bigWord"),
      oneLiner: document.getElementById("oneLiner"),
      locName: document.getElementById("locName"),
      locSource: document.getElementById("locSource"),
      nowTemp: document.getElementById("nowTemp"),
      nowSub: document.getElementById("nowSub"),
      forecastList: document.getElementById("forecastList"),

      wearList: document.getElementById("wearList"),

      runSelect: document.getElementById("runSelect"),
      manualInput: document.getElementById("manualInput"),
      locList: document.getElementById("locList"),
      spinBtn: document.getElementById("spinBtn"),
      gpsBtn: document.getElementById("gpsBtn"),

      detailsDrawer: document.getElementById("detailsDrawer"),
      detailsHint: document.getElementById("detailsHint"),
      detailsDay: document.getElementById("detailsDay"),
      detailsIcon: document.getElementById("detailsIcon"),
      detailsSummary: document.getElementById("detailsSummary"),
      detailsDecision: document.getElementById("detailsDecision"),
      detailsText: document.getElementById("detailsText"),
      detailsHigh: document.getElementById("detailsHigh"),
      detailsLow: document.getElementById("detailsLow"),
      chipsRow: document.getElementById("chipsRow"),
      sunUp: document.getElementById("sunUp"),
      sunDown: document.getElementById("sunDown"),

      toast: document.getElementById("toast"),
      mainLayout: document.getElementById("mainLayout"),
      
      refreshBtn: document.getElementById("refreshBtn"),
      themeBtn: document.getElementById("themeBtn"),
      shareBtn: document.getElementById("shareBtn"),
      lastUpdated: document.getElementById("lastUpdated"),
      loadingBar: document.getElementById("loadingBar"),
      
      hourlyBreakdown: document.getElementById("hourlyBreakdown"),
      hourlyContent: document.getElementById("hourlyContent"),
      dayTipsBox: document.getElementById("dayTipsBox"),
      dayTipsContent: document.getElementById("dayTipsContent")
    };

    const CURATED_CITIES = [
      // United States - Major Cities
      { label:"Las Vegas, NV", lat:36.1699, lon:-115.1398, cc:"US" },
      { label:"Tulsa, OK", lat:36.15398, lon:-95.99277, cc:"US" },
      { label:"Dallas, TX", lat:32.7767, lon:-96.7970, cc:"US" },
      { label:"Austin, TX", lat:30.2672, lon:-97.7431, cc:"US" },
      { label:"Chicago, IL", lat:41.8781, lon:-87.6298, cc:"US" },
      { label:"New York, NY", lat:40.7128, lon:-74.0060, cc:"US" },
      { label:"Los Angeles, CA", lat:34.0522, lon:-118.2437, cc:"US" },
      { label:"Seattle, WA", lat:47.6062, lon:-122.3321, cc:"US" },
      { label:"Denver, CO", lat:39.7392, lon:-104.9903, cc:"US" },
      { label:"Miami, FL", lat:25.7617, lon:-80.1918, cc:"US" },
      { label:"Phoenix, AZ", lat:33.4484, lon:-112.0740, cc:"US" },
      { label:"Boston, MA", lat:42.3601, lon:-71.0589, cc:"US" },
      { label:"Atlanta, GA", lat:33.7490, lon:-84.3880, cc:"US" },
      { label:"San Francisco, CA", lat:37.7749, lon:-122.4194, cc:"US" },
      
      // United States - More Cities
      { label:"Portland, OR", lat:45.5152, lon:-122.6784, cc:"US" },
      { label:"Minneapolis, MN", lat:44.9778, lon:-93.2650, cc:"US" },
      { label:"Detroit, MI", lat:42.3314, lon:-83.0458, cc:"US" },
      { label:"Philadelphia, PA", lat:39.9526, lon:-75.1652, cc:"US" },
      { label:"San Diego, CA", lat:32.7157, lon:-117.1611, cc:"US" },
      { label:"Nashville, TN", lat:36.1627, lon:-86.7816, cc:"US" },
      { label:"Charlotte, NC", lat:35.2271, lon:-80.8431, cc:"US" },
      { label:"Columbus, OH", lat:39.9612, lon:-82.9988, cc:"US" },
      { label:"Indianapolis, IN", lat:39.7684, lon:-86.1581, cc:"US" },
      { label:"San Antonio, TX", lat:29.4241, lon:-98.4936, cc:"US" },
      { label:"Houston, TX", lat:29.7604, lon:-95.3698, cc:"US" },
      { label:"New Orleans, LA", lat:29.9511, lon:-90.0715, cc:"US" },
      { label:"Salt Lake City, UT", lat:40.7608, lon:-111.8910, cc:"US" },
      { label:"Kansas City, MO", lat:39.0997, lon:-94.5786, cc:"US" },
      { label:"Milwaukee, WI", lat:43.0389, lon:-87.9065, cc:"US" },
      { label:"Anchorage, AK", lat:61.2181, lon:-149.9003, cc:"US" },
      { label:"Honolulu, HI", lat:21.3099, lon:-157.8581, cc:"US" },
      { label:"Boise, ID", lat:43.6150, lon:-116.2023, cc:"US" },
      { label:"Albuquerque, NM", lat:35.0844, lon:-106.6504, cc:"US" },
      { label:"Pittsburgh, PA", lat:40.4406, lon:-79.9959, cc:"US" },
      
      // Canada
      { label:"Toronto, Canada", lat:43.6532, lon:-79.3832, cc:"CA" },
      { label:"Vancouver, Canada", lat:49.2827, lon:-123.1207, cc:"CA" },
      { label:"Montreal, Canada", lat:45.5017, lon:-73.5673, cc:"CA" },
      { label:"Calgary, Canada", lat:51.0447, lon:-114.0719, cc:"CA" },
      { label:"Ottawa, Canada", lat:45.4215, lon:-75.6972, cc:"CA" },
      { label:"Edmonton, Canada", lat:53.5461, lon:-113.4938, cc:"CA" },
      { label:"Winnipeg, Canada", lat:49.8951, lon:-97.1384, cc:"CA" },
      { label:"Quebec City, Canada", lat:46.8139, lon:-71.2080, cc:"CA" },
      
      // Mexico & Central America
      { label:"Mexico City, Mexico", lat:19.4326, lon:-99.1332, cc:"MX" },
      { label:"Guadalajara, Mexico", lat:20.6597, lon:-103.3496, cc:"MX" },
      { label:"Monterrey, Mexico", lat:25.6866, lon:-100.3161, cc:"MX" },
      { label:"Cancun, Mexico", lat:21.1619, lon:-86.8515, cc:"MX" },
      { label:"San Jose, Costa Rica", lat:9.9281, lon:-84.0907, cc:"CR" },
      { label:"Panama City, Panama", lat:8.9824, lon:-79.5199, cc:"PA" },
      
      // South America
      { label:"S√£o Paulo, Brazil", lat:-23.5505, lon:-46.6333, cc:"BR" },
      { label:"Rio de Janeiro, Brazil", lat:-22.9068, lon:-43.1729, cc:"BR" },
      { label:"Buenos Aires, Argentina", lat:-34.6037, lon:-58.3816, cc:"AR" },
      { label:"Lima, Peru", lat:-12.0464, lon:-77.0428, cc:"PE" },
      { label:"Bogot√°, Colombia", lat:4.7110, lon:-74.0721, cc:"CO" },
      { label:"Santiago, Chile", lat:-33.4489, lon:-70.6693, cc:"CL" },
      { label:"Quito, Ecuador", lat:-0.1807, lon:-78.4678, cc:"EC" },
      { label:"Caracas, Venezuela", lat:10.4806, lon:-66.9036, cc:"VE" },
      { label:"Montevideo, Uruguay", lat:-34.9011, lon:-56.1645, cc:"UY" },
      
      // Europe - Western
      { label:"London, UK", lat:51.5072, lon:-0.1276, cc:"GB" },
      { label:"Paris, France", lat:48.8566, lon:2.3522, cc:"FR" },
      { label:"Berlin, Germany", lat:52.5200, lon:13.4050, cc:"DE" },
      { label:"Rome, Italy", lat:41.9028, lon:12.4964, cc:"IT" },
      { label:"Madrid, Spain", lat:40.4168, lon:-3.7038, cc:"ES" },
      { label:"Amsterdam, Netherlands", lat:52.3676, lon:4.9041, cc:"NL" },
      { label:"Brussels, Belgium", lat:50.8503, lon:4.3517, cc:"BE" },
      { label:"Vienna, Austria", lat:48.2082, lon:16.3738, cc:"AT" },
      { label:"Zurich, Switzerland", lat:47.3769, lon:8.5417, cc:"CH" },
      { label:"Barcelona, Spain", lat:41.3851, lon:2.1734, cc:"ES" },
      { label:"Milan, Italy", lat:45.4642, lon:9.1900, cc:"IT" },
      { label:"Munich, Germany", lat:48.1351, lon:11.5820, cc:"DE" },
      { label:"Dublin, Ireland", lat:53.3498, lon:-6.2603, cc:"IE" },
      { label:"Lisbon, Portugal", lat:38.7223, lon:-9.1393, cc:"PT" },
      { label:"Copenhagen, Denmark", lat:55.6761, lon:12.5683, cc:"DK" },
      { label:"Stockholm, Sweden", lat:59.3293, lon:18.0686, cc:"SE" },
      { label:"Oslo, Norway", lat:59.9139, lon:10.7522, cc:"NO" },
      { label:"Helsinki, Finland", lat:60.1699, lon:24.9384, cc:"FI" },
      
      // Europe - Eastern
      { label:"Warsaw, Poland", lat:52.2297, lon:21.0122, cc:"PL" },
      { label:"Prague, Czech Republic", lat:50.0755, lon:14.4378, cc:"CZ" },
      { label:"Budapest, Hungary", lat:47.4979, lon:19.0402, cc:"HU" },
      { label:"Athens, Greece", lat:37.9838, lon:23.7275, cc:"GR" },
      { label:"Bucharest, Romania", lat:44.4268, lon:26.1025, cc:"RO" },
      { label:"Sofia, Bulgaria", lat:42.6977, lon:23.3219, cc:"BG" },
      { label:"Moscow, Russia", lat:55.7558, lon:37.6173, cc:"RU" },
      { label:"St. Petersburg, Russia", lat:59.9343, lon:30.3351, cc:"RU" },
      { label:"Kiev, Ukraine", lat:50.4501, lon:30.5234, cc:"UA" },
      
      // Asia - East
      { label:"Tokyo, Japan", lat:35.6762, lon:139.6503, cc:"JP" },
      { label:"Seoul, South Korea", lat:37.5665, lon:126.9780, cc:"KR" },
      { label:"Beijing, China", lat:39.9042, lon:116.4074, cc:"CN" },
      { label:"Shanghai, China", lat:31.2304, lon:121.4737, cc:"CN" },
      { label:"Hong Kong", lat:22.3193, lon:114.1694, cc:"HK" },
      { label:"Taipei, Taiwan", lat:25.0330, lon:121.5654, cc:"TW" },
      { label:"Osaka, Japan", lat:34.6937, lon:135.5023, cc:"JP" },
      { label:"Kyoto, Japan", lat:35.0116, lon:135.7681, cc:"JP" },
      
      // Asia - Southeast
      { label:"Singapore", lat:1.3521, lon:103.8198, cc:"SG" },
      { label:"Bangkok, Thailand", lat:13.7563, lon:100.5018, cc:"TH" },
      { label:"Manila, Philippines", lat:14.5995, lon:120.9842, cc:"PH" },
      { label:"Jakarta, Indonesia", lat:-6.2088, lon:106.8456, cc:"ID" },
      { label:"Kuala Lumpur, Malaysia", lat:3.1390, lon:101.6869, cc:"MY" },
      { label:"Ho Chi Minh City, Vietnam", lat:10.8231, lon:106.6297, cc:"VN" },
      { label:"Hanoi, Vietnam", lat:21.0285, lon:105.8542, cc:"VN" },
      
      // Asia - South
      { label:"Mumbai, India", lat:19.0760, lon:72.8777, cc:"IN" },
      { label:"Delhi, India", lat:28.7041, lon:77.1025, cc:"IN" },
      { label:"Bangalore, India", lat:12.9716, lon:77.5946, cc:"IN" },
      { label:"Karachi, Pakistan", lat:24.8607, lon:67.0011, cc:"PK" },
      { label:"Dhaka, Bangladesh", lat:23.8103, lon:90.4125, cc:"BD" },
      { label:"Colombo, Sri Lanka", lat:6.9271, lon:79.8612, cc:"LK" },
      
      // Middle East
      { label:"Dubai, UAE", lat:25.2048, lon:55.2708, cc:"AE" },
      { label:"Abu Dhabi, UAE", lat:24.4539, lon:54.3773, cc:"AE" },
      { label:"Istanbul, Turkey", lat:41.0082, lon:28.9784, cc:"TR" },
      { label:"Tel Aviv, Israel", lat:32.0853, lon:34.7818, cc:"IL" },
      { label:"Jerusalem, Israel", lat:31.7683, lon:35.2137, cc:"IL" },
      { label:"Beirut, Lebanon", lat:33.8886, lon:35.4955, cc:"LB" },
      { label:"Riyadh, Saudi Arabia", lat:24.7136, lon:46.6753, cc:"SA" },
      { label:"Doha, Qatar", lat:25.2854, lon:51.5310, cc:"QA" },
      { label:"Kuwait City, Kuwait", lat:29.3759, lon:47.9774, cc:"KW" },
      
      // Africa
      { label:"Cairo, Egypt", lat:30.0444, lon:31.2357, cc:"EG" },
      { label:"Cape Town, South Africa", lat:-33.9249, lon:18.4241, cc:"ZA" },
      { label:"Johannesburg, South Africa", lat:-26.2041, lon:28.0473, cc:"ZA" },
      { label:"Lagos, Nigeria", lat:6.5244, lon:3.3792, cc:"NG" },
      { label:"Nairobi, Kenya", lat:-1.2864, lon:36.8172, cc:"KE" },
      { label:"Casablanca, Morocco", lat:33.5731, lon:-7.5898, cc:"MA" },
      { label:"Accra, Ghana", lat:5.6037, lon:-0.1870, cc:"GH" },
      { label:"Tunis, Tunisia", lat:36.8065, lon:10.1815, cc:"TN" },
      { label:"Addis Ababa, Ethiopia", lat:9.0320, lon:38.7469, cc:"ET" },
      
      // Oceania
      { label:"Sydney, Australia", lat:-33.8688, lon:151.2093, cc:"AU" },
      { label:"Melbourne, Australia", lat:-37.8136, lon:144.9631, cc:"AU" },
      { label:"Brisbane, Australia", lat:-27.4698, lon:153.0251, cc:"AU" },
      { label:"Perth, Australia", lat:-31.9505, lon:115.8605, cc:"AU" },
      { label:"Auckland, New Zealand", lat:-36.8485, lon:174.7633, cc:"NZ" },
      { label:"Wellington, New Zealand", lat:-41.2865, lon:174.7762, cc:"NZ" },
      { label:"Christchurch, New Zealand", lat:-43.5321, lon:172.6362, cc:"NZ" },
      
      // Interesting/Extreme Weather Locations
      { label:"Reykjavik, Iceland", lat:64.1466, lon:-21.9426, cc:"IS" },
      { label:"Troms√∏, Norway", lat:69.6492, lon:18.9553, cc:"NO" },
      { label:"Fairbanks, AK", lat:64.8378, lon:-147.7164, cc:"US" },
      { label:"Barrow, AK", lat:71.2906, lon:-156.7886, cc:"US" },
      { label:"Ushuaia, Argentina", lat:-54.8019, lon:-68.3029, cc:"AR" },
      { label:"Darwin, Australia", lat:-12.4634, lon:130.8456, cc:"AU" }
    ];

    const WEATHER_CODES = {
      0:"Clear",1:"Mostly clear",2:"Partly cloudy",3:"Overcast",
      45:"Fog",48:"Rime fog",51:"Light drizzle",53:"Drizzle",55:"Heavy drizzle",
      61:"Light rain",63:"Rain",65:"Heavy rain",
      71:"Light snow",73:"Snow",75:"Heavy snow",
      80:"Rain showers",81:"Heavy showers",82:"Violent showers",
      95:"Thunderstorm",96:"Thunderstorm with hail",99:"Thunderstorm with heavy hail"
    };

    const QUIPS = {
      HOODIE: [
        "Yes. Hoodie plus life choices that include layers.",
        "Yep. Hoodie weather. Enjoy the smug warmth.",
        "Hoodie time. Your ears will send a thank-you note.",
        "Put the hood up and pretend you are mysterious.",
        "Wear the hoodie. Regret is for bare wrists.",
        "This is hoodie weather and it knows it.",
        "Hoodie recommended. Bonus points for pockets.",
        "If you skip the hoodie, you will think about it all day.",
        "Hoodie season. Lean into it.",
        "Hoodie on. The wind is being rude.",
        "Hoodie is the correct moral choice here.",
        "You want sleeves and plausible deniability. Hoodie.",
        "Yes hoodie. The air is spicy.",
        "Hoodie now. Your future self is grateful.",
        "Hoodie. You can still look cool while surviving."
      ],
      MAYBE: [
        "Could go either way. Hoodie if you like options.",
        "Borderline. Hoodie for the shade, nah for the sun.",
        "A true toss-up. Bring the hoodie just to feel powerful.",
        "Not cold, not warm. Annoyingly in-between.",
        "Hoodie if you will be outside longer than five minutes.",
        "Maybe hoodie. The wind might try something.",
        "Coin-flip weather. Hoodie is the insurance policy.",
        "Maybe hoodie. Mostly for the pockets.",
        "Borderline. Hoodie for mornings, nah for afternoons.",
        "Layer-friendly weather. Hoodie on standby."
      ],
      NAH: [
        "Nope. Hoodie would be a personal attack on your pores.",
        "Nah. Let your shoulders live a little.",
        "Skip the hoodie. You are not in a music video.",
        "No hoodie. Hydrate and pretend you are fine.",
        "Hoodie would be spicy overkill. Pass.",
        "Too warm. Hoodie is cosplay at this point.",
        "Let the breeze live rent-free. No hoodie.",
        "Nah. Pocket warmth not required today."
      ],
      PARKA: [
        "Parka time. Hoodie alone is a betrayal.",
        "Layer the hoodie under a parka. Trust me.",
        "Parka or bust. Your eyelashes would like to stay unfrosted.",
        "Parka weather. Hoodie is the understudy.",
        "Parka plus hoodie. Fashion is now survival."
      ]
    };

    const WEAR_SNARK = {
      HOODIE: {
        base: [
          "Hoodie. Obviously. Zip or pullover, choose your character.",
          "Put on a hoodie and act like you planned this.",
          "Hoodie time. Your wrists deserve protection.",
          "Hoodie, and yes, you may use the pocket for emotional support.",
          "Hoodie weather. Take the win."
        ],
        cold: [
          "Hoodie plus a jacket. You are not proving anything today.",
          "Hoodie and a coat. Survival first, drip second.",
          "Layer up. Hoodie is the inner armor."
        ]
      },
      MAYBE: {
        base: [
          "Light hoodie or long sleeve. Commit to flexibility.",
          "Bring the hoodie if you hate being mildly annoyed.",
          "This is 'hoodie in the car' weather.",
          "Maybe hoodie. Mainly for the pockets and the vibes.",
          "Start with a layer. You can always pretend you are fine later."
        ]
      },
      NAH: {
        base: [
          "No hoodie. Let your elbows breathe.",
          "Skip the hoodie. This is a sleeves-optional situation.",
          "Nah. Hoodie would be overachieving.",
          "No hoodie. You will regret it in 30 seconds if you do.",
          "Hoodie stays benched today."
        ]
      },
      PARKA: {
        base: [
          "Parka plus hoodie. Warmth is now a team sport.",
          "Wear a parka. Hoodie goes underneath as moral support.",
          "Full parka mode. Zippers up, drama down.",
          "Parka with a hood. Double hood if you believe in redundancy.",
          "Insulated parka. Pretend you are an expedition leader."
        ],
        deep: [
          "Add thermal base layers. Your bones will notice.",
          "Gloves, beanie, and a scarf. Negotiate with the wind.",
          "Water-resistant parka if the sky looks dramatic."
        ]
      },
      wind: [
        "Wind is being loud. Add a shell so it stops getting ideas.",
        "Wind advisory for your face. Consider a light shell.",
        "If the wind is rude, wear something that can argue back."
      ],
      calm: [
        "Wind is chill. You can stop fighting the air.",
        "No wind drama. Enjoy the peace.",
        "Air is behaving. Rare."
      ],
      wet: [
        "Rain plan: water-resistant layer. Moist is not a personality.",
        "Bring a rain layer. Hoodies soak like a sponge with dreams.",
        "Wet weather. Choose fabric that does not give up immediately."
      ],
      dry: [
        "Dry forecast. Your socks are safe. For now.",
        "No rain. You can relax your shoulders.",
        "Dry skies. Proceed without puddle paranoia."
      ],
      shoes: [
        "Closed shoes. Cold toes are a betrayal.",
        "Wear shoes you can defend in court.",
        "Footwear that does not hate you later."
      ],
      extrasCold: [
        "Beanie optional, but your ears will remember this.",
        "Gloves if you plan to touch metal like a hero.",
        "Warm socks. Do not negotiate with cold ankles."
      ],
      extrasWarm: [
        "Breathable top. Do not turn into soup.",
        "Sunglasses if you enjoy seeing.",
        "Deodorant remains undefeated."
      ]
    };

    const state = loadState() || {
      lat: null,
      lon: null,
      placeLabel: "Near you",
      countryCode: null,
      source: "auto",
      units: "F",
      unitOverride: null,
      run: "normal",
      lastForecast: null,
      selectedIdx: 0,
      spinSeen: [],
      lastWearSig: "",
      lastUpdated: null,
      theme: "dark",
      currentConditions: null  // Store current weather for live verdict updates
    };

    let suggestTimer = null;
    let suggestSeq = 0;

    // placeholders for DOM restore
    const placeholders = {
      detailsParent: el.detailsCard.parentNode,
      detailsNext: el.detailsCard.nextSibling,
      leftParent: el.leftCard.parentNode,
      leftNext: el.leftCard.nextSibling,
      rightParent: el.rightCard.parentNode,
      rightNext: el.rightCard.nextSibling
    };
    let mobileApplied = false;

    function applyMobileLayout(){
      if (mobileApplied) return;
      const main = el.mainLayout;
      // Order: form (rightCard) -> main verdict/forecast (leftCard) -> detailsCard
      if (main.firstChild !== el.rightCard){
        main.insertBefore(el.rightCard, main.firstChild);
      }
      if (el.leftCard.previousSibling !== el.rightCard){
        main.insertBefore(el.leftCard, el.rightCard.nextSibling);
      }
      if (el.detailsCard.parentNode !== main){
        main.insertBefore(el.detailsCard, el.leftCard.nextSibling);
      }
      mobileApplied = true;
    }
    function revertMobileLayout(){
      if (!mobileApplied) return;
      // Restore original order: leftCard, rightCard, detailsCard (at end)
      if (placeholders.leftParent){
        placeholders.leftParent.insertBefore(el.leftCard, placeholders.leftNext);
      }
      if (placeholders.rightParent){
        placeholders.rightParent.insertBefore(el.rightCard, placeholders.rightNext);
      }
      if (placeholders.detailsParent){
        placeholders.detailsParent.insertBefore(el.detailsCard, placeholders.detailsNext);
      }
      mobileApplied = false;
    }
    function handleResponsive(){
      if (window.innerWidth <= 720){
        applyMobileLayout();
      }else{
        revertMobileLayout();
      }
    }

    function showToast(msg){
      el.toast.textContent = msg;
      el.toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.toast.classList.remove("show"), 2200);
    }
    
    function updateTimestamp(){
      state.lastUpdated = new Date().toISOString();
      saveState();
      const now = new Date(state.lastUpdated);
      const timeStr = now.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' });
      if (el.lastUpdated) {
        el.lastUpdated.textContent = `Updated ${timeStr}`;
      }
    }
    
    async function shareVerdict(){
      const verdict = el.bigWord.textContent || "HOODIE";
      const location = state.placeLabel || "your location";
      const temp = el.nowTemp.textContent || "--";
      const text = `${verdict}! üß•\n\nIt's ${temp} in ${location}. Check if you need a hoodie at hoodieornah.com`;
      
      if (navigator.share) {
        try {
          await navigator.share({ text, url: window.location.href });
          showToast("Shared successfully!");
        } catch (e) {
          if (e.name !== 'AbortError') {
            copyToClipboard(text);
          }
        }
      } else {
        copyToClipboard(text);
      }
    }
    
    function copyToClipboard(text){
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showToast("Copied to clipboard!");
        }).catch(() => {
          showToast("Could not copy");
        });
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showToast("Copied to clipboard!");
        } catch (e) {
          showToast("Could not copy");
        }
        document.body.removeChild(textarea);
      }
    }
    
    function toggleTheme(){
      const html = document.documentElement;
      if (html.classList.contains('theme-dark')) {
        html.classList.remove('theme-dark');
        html.classList.add('theme-light');
        state.theme = 'light';
      } else {
        html.classList.remove('theme-light');
        html.classList.add('theme-dark');
        state.theme = 'dark';
      }
      saveState();
    }
    
    function applyTheme(){
      const html = document.documentElement;
      if (state.theme === 'light') {
        html.classList.remove('theme-dark');
        html.classList.add('theme-light');
      } else {
        html.classList.remove('theme-light');
        html.classList.add('theme-dark');
      }
    }

    function saveState(){
      try{ localStorage.setItem("hoodieornah_state_v4", JSON.stringify(state)); }catch(e){}
    }
    function loadState(){
      try{
        const raw = localStorage.getItem("hoodieornah_state_v4");
        if (!raw) return null;
        return JSON.parse(raw);
      }catch(e){ return null; }
    }

    function setLoadingUI(){
      el.bigWord.textContent = "LOADING";
      el.bigWord.className = "bigword loading-shimmer";
      el.oneLiner.textContent = pickLoadingCopy();
      el.nowTemp.textContent = "--";
      el.nowSub.textContent = "Feels like: -- | Wind: --";
      el.leftCard?.classList.add("loading");
      el.loadingBar?.classList.add("active");
    }
    function endLoadingUI(){
      el.leftCard?.classList.remove("loading");
      el.loadingBar?.classList.remove("active");
      updateTimestamp();
    }

    function setPill(text){ el.pillText.textContent = text || "Near you"; }
    function updateSourceUI(){
      const src = state.source || "auto";
      const label = src === "gps" ? "gps" : src === "manual" ? "manual" : src === "globe" ? "globe" : "auto";
      el.locSource.textContent = "Source: " + label;
    }

    function countryUsesF(cc){
      const f = new Set(["US","BS","BZ","KY","PW","FM","MH","LR"]);
      return cc && f.has(cc.toUpperCase());
    }

    function currentUnits(){
      if (state.unitOverride === "F") return "F";
      if (state.unitOverride === "C") return "C";
      return state.units || "F";
    }

    function setUnitControlButtons(){
      const u = currentUnits();
      el.unitAuto.setAttribute("aria-pressed", state.unitOverride ? "false" : "true");
      el.unitF.setAttribute("aria-pressed", u === "F" ? "true" : "false");
      el.unitC.setAttribute("aria-pressed", u === "C" ? "true" : "false");
    }

    function fmtTemp(v){
      if (v==null || Number.isNaN(v)) return "--";
      return Math.round(v) + "\u00B0" + currentUnits();
    }

    function windText(ms){
      if (ms==null || Number.isNaN(ms)) return "--";
      const mph = ms * 2.236936;
      return Math.round(mph) + " mph";
    }

    function fmtTimeHM(iso){
      if (!iso) return "--";
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "--";
      return d.toLocaleTimeString(undefined, { hour:"numeric", minute:"2-digit" });
    }

    function verdictForFeels(feelsF, run, windMps){
      const mph = (windMps || 0) * 2.236936;
      let adj = feelsF;
      if (run === "cold") adj -= 3;
      if (run === "hot") adj += 3;
      adj -= mph * 0.15;
      
      // More realistic thresholds
      if (adj <= 25) return { key:"PARKA" };    // Actually freezing/dangerous
      if (adj <= 50) return { key:"HOODIE" };   // Classic hoodie weather
      if (adj <= 65) return { key:"MAYBE" };    // Borderline/transitional
      return { key:"NAH" };                     // Too warm for hoodie
    }

    function iconForCode(code){
      const c = Number(code);
      const map = { sun:"\u2600\uFE0F", cloud:"\u2601\uFE0F", fog:"\uD83C\uDF2B\uFE0F", rain:"\uD83C\uDF27\uFE0F", storm:"\u26C8\uFE0F", snow:"\u2744\uFE0F" };
      if (c === 0) return wrap(map.sun);
      if (c >= 1 && c <= 3) return wrap(map.cloud);
      if (c === 45 || c === 48) return wrap(map.fog);
      if ((c >= 51 && c <= 67) || (c >= 80 && c <= 82)) return wrap(map.rain);
      if (c >= 71 && c <= 77) return wrap(map.snow);
      if (c >= 95) return wrap(map.storm);
      return wrap("\uD83C\uDF21\uFE0F¬è");
      function wrap(e){ return "<span style='font-size:20px; line-height:1;'>" + e + "</span>"; }
    }

    function safeDayLabel(dateISO){
      const d = new Date(dateISO);
      if (Number.isNaN(d.getTime())) return "--";
      return d.toLocaleDateString(undefined, { month:"short", day:"numeric" });
    }

    function pickLoadingCopy(){
      const lines = [
        "Fetching weather receipts...",
        "Consulting the hoodie council...",
        "Interrogating the wind...",
        "Bribing the clouds for data...",
        "Calibrating pocket warmth..."
      ];
      return lines[Math.floor(Math.random()*lines.length)];
    }

    function pickQuip(word){
      const pool = QUIPS[word] || ["Weather is doing a thing. You do you."];
      return pool[Math.floor(Math.random()*pool.length)];
    }

    function uniqueSample(pool, n){
      const src = (pool || []).slice();
      const out = [];
      while (src.length && out.length < n){
        const i = Math.floor(Math.random() * src.length);
        out.push(src.splice(i,1)[0]);
      }
      return out;
    }

    function buildWearLines(verdict, feelsF, windMps, precipPct, code){
      const mph = (windMps || 0) * 2.236936;

      const wetCodes = new Set([51,53,55,61,63,65,80,81,82,95,96,99]);
      const snowCodes = new Set([71,73,75]);
      const isWet = (precipPct >= 40) || wetCodes.has(Number(code));
      const isSnow = snowCodes.has(Number(code));
      const isWindy = mph >= 12;
      const isCold = feelsF <= 38;
      const isVeryCold = feelsF <= 25;
      const isWarm = feelsF >= 72;

      let basePool = (WEAR_SNARK[verdict] && WEAR_SNARK[verdict].base) ? WEAR_SNARK[verdict].base : [];
      if (verdict === "HOODIE" && isCold && WEAR_SNARK.HOODIE.cold) {
        basePool = basePool.concat(WEAR_SNARK.HOODIE.cold);
      }
      if (verdict === "PARKA" && isVeryCold && WEAR_SNARK.PARKA.deep) {
        basePool = basePool.concat(WEAR_SNARK.PARKA.deep);
      }

      const line1 = uniqueSample(basePool, 1)[0] || "Wear something. The weather is real.";

      const windPool = isWindy ? WEAR_SNARK.wind : WEAR_SNARK.calm;
      const wetPool = (isWet || isSnow) ? WEAR_SNARK.wet : WEAR_SNARK.dry;

      const helperPicks = uniqueSample(windPool.concat(wetPool).concat(WEAR_SNARK.shoes), 2);
      let line2 = helperPicks[0] || "Wind exists. Act accordingly.";
      let line3 = helperPicks[1] || "Shoes. Just trust me.";

      if (verdict === "PARKA"){
        const extra = uniqueSample(WEAR_SNARK.extrasCold, 1)[0];
        if (extra) line3 = extra;
      } else if (isCold && verdict !== "NAH"){
        const extra = uniqueSample(WEAR_SNARK.extrasCold, 1)[0];
        if (extra) line3 = extra;
      } else if (isWarm && verdict === "NAH"){
        const extra = uniqueSample(WEAR_SNARK.extrasWarm, 1)[0];
        if (extra) line3 = extra;
      }

      return [line1, line2, line3];
    }
    
    function generateDayTips(d, verdict){
      const tips = [];
      const mph = (d.wind || 0) * 2.236936;
      const feelsMid = (d.appMax + d.appMin) / 2;
      const tempSwing = d.tMax - d.tMin;
      
      // Temperature swing tip
      if (tempSwing >= 25) {
        tips.push("Big temperature swing today. Layer up so you can adjust.");
      } else if (tempSwing >= 15) {
        tips.push("Temperature will change throughout the day. Bring options.");
      }
      
      // Precipitation tip
      if (d.precip >= 60) {
        tips.push("High chance of rain. Waterproof layer recommended.");
      } else if (d.precip >= 30) {
        tips.push("Rain possible. Keep an umbrella handy.");
      }
      
      // Wind tip
      if (mph >= 20) {
        tips.push("Windy conditions. Secure loose items and expect wind chill.");
      } else if (mph >= 12) {
        tips.push("Moderate wind. A windbreaker helps.");
      }
      
      // Temperature-specific tips
      if (feelsMid <= 20) {
        tips.push("Extreme cold. Limit outdoor exposure and cover all skin.");
      } else if (feelsMid <= 32) {
        tips.push("Freezing temps. Watch for ice and bundle up.");
      } else if (feelsMid >= 85) {
        tips.push("Hot day. Stay hydrated and seek shade when possible.");
      }
      
      // Weather code specific tips
      const code = Number(d.code);
      if (code >= 95) {
        tips.push("Thunderstorms expected. Stay indoors during peak activity.");
      } else if (code >= 71 && code <= 77) {
        tips.push("Snow forecast. Allow extra travel time.");
      } else if (code === 0) {
        tips.push("Clear skies. Great day for outdoor activities.");
      }
      
      // Return up to 2 tips
      return tips.slice(0, 2);
    }
    
    function generateHourlyBreakdown(d, run){
      // Estimate temperatures at key times throughout the day
      // Based on typical temperature curves: coldest at sunrise, warmest mid-afternoon
      const low = d.appMin;
      const high = d.appMax;
      const range = high - low;
      
      const periods = [
        {
          label: "Early Morning",
          time: "6-9 AM",
          // Close to minimum (sunrise time)
          temp: low + (range * 0.1)
        },
        {
          label: "Late Morning", 
          time: "9 AM-12 PM",
          // Warming up
          temp: low + (range * 0.5)
        },
        {
          label: "Afternoon",
          time: "12-4 PM",
          // Peak temperature
          temp: high - (range * 0.05)
        },
        {
          label: "Evening",
          time: "4-8 PM",
          // Cooling down
          temp: low + (range * 0.4)
        }
      ];
      
      return periods.map(period => {
        const verdict = verdictForFeels(period.temp, run, d.wind);
        return {
          label: period.label,
          time: period.time,
          temp: period.temp,
          verdict: verdict.key
        };
      });
    }
    
    function renderHourlyBreakdown(periods){
      if (!el.hourlyContent) return;
      
      const verdictColors = {
        PARKA: "rgba(129,140,248,.95)",
        HOODIE: "rgba(96,165,250,.95)",
        MAYBE: "rgba(251,191,36,.95)",
        NAH: "rgba(248,113,113,.95)"
      };
      
      const html = periods.map(p => {
        const color = verdictColors[p.verdict] || "var(--text)";
        return `
          <div style="display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-radius:10px; background:var(--panel); border:1px solid var(--stroke);">
            <div style="flex:1;">
              <div style="font-size:11px; color:var(--muted2); margin-bottom:2px;">${p.time}</div>
              <div style="font-size:12px; font-weight:600; color:var(--text);">${p.label}</div>
            </div>
            <div style="text-align:right;">
              <div style="font-size:14px; font-weight:700; color:var(--text);">${fmtTemp(p.temp)}</div>
              <div style="font-size:10px; font-weight:700; color:${color}; margin-top:2px;">${p.verdict}</div>
            </div>
          </div>
        `;
      }).join("");
      
      el.hourlyContent.innerHTML = html;
    }

    function renderWearByVerdict(verdict, feelsF, windMps, precipPct, code){
      let tries = 0;
      let lines = buildWearLines(verdict, feelsF, windMps, precipPct, code);
      let sig = verdict + "|" + lines.join("|");

      while (tries < 5 && sig === state.lastWearSig){
        lines = buildWearLines(verdict, feelsF, windMps, precipPct, code);
        sig = verdict + "|" + lines.join("|");
        tries++;
      }

      state.lastWearSig = sig;
      saveState();

      el.wearList.innerHTML = lines.map(t => "<li>" + t + "</li>").join("");
    }

    async function geocodeDisplayName(q){
      const url = "https://nominatim.openstreetmap.org/search?format=jsonv2&limit=6&addressdetails=1&q=" + encodeURIComponent(q);
      const res = await fetch(url, { headers: { "Accept":"application/json" } });
      if (!res.ok) throw new Error("geocode_failed");
      const data = await res.json();
      return (data || []).map((r) => {
        const a = r.address || {};
        const cc = (a.country_code || "").toUpperCase() || null;
        const label = r.display_name || q;
        return { label, lat: Number(r.lat), lon: Number(r.lon), countryCode: cc };
      }).filter(x => Number.isFinite(x.lat) && Number.isFinite(x.lon));
    }

    async function reverseGeocodeToLabel(lat, lon){
      const url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + encodeURIComponent(lat) + "&lon=" + encodeURIComponent(lon) + "&addressdetails=1";
      const res = await fetch(url, { headers: { "Accept":"application/json" } });
      if (!res.ok) throw new Error("reverse_failed");
      const data = await res.json();
      const a = data.address || {};
      const cc = (a.country_code || "").toUpperCase() || null;
      const city = a.city || a.town || a.village || a.hamlet || a.county || "";
      const region = a.state || a.region || a.province || "";
      let label = (city && region) ? (city + ", " + region) : (city || region || data.display_name || "Near you");
      if (cc && cc !== "US" && a.country){
        if (city) label = city + ", " + a.country;
        else label = (region ? region + ", " : "") + a.country;
      }
      return { label, cc };
    }

    async function fetchOpenMeteo(lat, lon){
      const units = currentUnits() === "F" ? "fahrenheit" : "celsius";
      const windUnits = "ms";
      const tz = "auto";
      const url = "https://api.open-meteo.com/v1/forecast"
        + "?latitude=" + encodeURIComponent(lat)
        + "&longitude=" + encodeURIComponent(lon)
        + "&temperature_unit=" + units
        + "&wind_speed_unit=" + windUnits
        + "&timezone=" + encodeURIComponent(tz)
        + "&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m,relative_humidity_2m"
        + "&daily=weather_code,temperature_2m_max,temperature_2m_min,apparent_temperature_max,apparent_temperature_min,precipitation_probability_max,wind_speed_10m_max,sunrise,sunset";
      const res = await fetch(url);
      if (!res.ok) throw new Error("weather_failed");
      return res.json();
    }

    function renderNow(current){
      const feels = current.apparent_temperature;
      const temp = current.temperature_2m;
      const wind = current.wind_speed_10m;
      el.nowTemp.textContent = fmtTemp(temp);
      el.nowSub.textContent = "Feels like: " + fmtTemp(feels) + " | Wind: " + windText(wind);
      return { temp, feels, wind };
    }

    function buildDailyArray(daily){
      const len = Math.min(5, (daily.time || []).length);
      const out = [];
      for (let i = 0; i < len; i++){
        out.push({
          date: daily.time[i],
          code: daily.weather_code[i],
          tMax: daily.temperature_2m_max[i],
          tMin: daily.temperature_2m_min[i],
          appMax: daily.apparent_temperature_max[i],
          appMin: daily.apparent_temperature_min[i],
          precip: daily.precipitation_probability_max[i],
          wind: daily.wind_speed_10m_max[i],
          sunrise: daily.sunrise[i],
          sunset: daily.sunset[i]
        });
      }
      return out;
    }

    function renderBigVerdict(feelsF, run, windMps, precipPct, code){
      const verdict = verdictForFeels(feelsF, run, windMps);
      
      // Remove animation class, set text and color class
      el.bigWord.className = "bigword";
      el.bigWord.textContent = verdict.key;
      
      // Trigger reflow to restart animation
      void el.bigWord.offsetWidth;
      
      // Add color class with animation
      el.bigWord.className = "bigword " + verdict.key;
      
      el.oneLiner.textContent = pickQuip(verdict.key);
      renderWearByVerdict(verdict.key, feelsF, windMps, precipPct, code);
    }

    function renderForecast(dailyArr){
      el.forecastList.innerHTML = "";
      dailyArr.forEach((d, idx) => {
        const div = document.createElement("button");
        div.className = "forecast-item";
        div.type = "button";
        div.setAttribute("data-idx", String(idx));
        div.innerHTML = `
          <div class="forecast-top">
            <b>${safeDayLabel(d.date)}</b>
            ${iconForCode(d.code)}
          </div>
          <div class="forecast-mid">
            ${WEATHER_CODES[d.code] || "Weather"}
            <strong>${fmtTemp(d.tMax)} / ${fmtTemp(d.tMin)}</strong>
          </div>
          <div class="forecast-line">
            Precip: ${d.precip ?? "--"}% | Wind: ${windText(d.wind)}
          </div>
        `;
        div.addEventListener("click", () => selectForecastIndex(idx));
        el.forecastList.appendChild(div);
      });
      selectForecastIndex(0, true);
    }

    function renderDetails(d, run){
      el.detailsDay.textContent = safeDayLabel(d.date);
      el.detailsIcon.innerHTML = iconForCode(d.code);
      el.detailsSummary.textContent = WEATHER_CODES[d.code] || "Weather";

      const feelsMid = (d.appMax + d.appMin) / 2;
      const verdict = verdictForFeels(feelsMid, run, d.wind);

      el.detailsDecision.textContent = verdict.key;
      el.detailsText.textContent = pickQuip(verdict.key);
      el.detailsHigh.textContent = fmtTemp(d.tMax);
      el.detailsLow.textContent = fmtTemp(d.tMin);
      el.sunUp.textContent = fmtTimeHM(d.sunrise);
      el.sunDown.textContent = fmtTimeHM(d.sunset);

      const chips = [
        "Feels: " + fmtTemp(feelsMid),
        "Wind: " + windText(d.wind),
        "Precip: " + (d.precip ?? "--") + "%"
      ];
      el.chipsRow.innerHTML = chips.map(c => "<span class=\"chip\">" + c + "</span>").join("");

      // Generate and display hourly breakdown
      const hourlyPeriods = generateHourlyBreakdown(d, run);
      renderHourlyBreakdown(hourlyPeriods);

      // Generate and display day tips
      const dayTips = generateDayTips(d, verdict.key);
      if (dayTips.length > 0 && el.dayTipsBox && el.dayTipsContent) {
        el.dayTipsContent.innerHTML = dayTips.map(tip => "<div style='margin-bottom:4px;'>‚Ä¢ " + tip + "</div>").join("");
        el.dayTipsBox.style.display = "block";
      } else if (el.dayTipsBox) {
        el.dayTipsBox.style.display = "none";
      }

      renderWearByVerdict(verdict.key, feelsMid, d.wind, d.precip, d.code);
      renderBigVerdict(feelsMid, run, d.wind, d.precip, d.code);
    }

    function selectForecastIndex(idx, fromAuto=false){
      state.selectedIdx = idx;
      saveState();

      [...el.forecastList.children].forEach((c,i)=> c.classList.toggle("selected", i===idx));
      const d = (state.lastForecast || [])[idx];
      if (!d) return;

      renderDetails(d, state.run);
      el.detailsHint.textContent = fromAuto ? "Auto-filled for today" : "Showing selection";
    }

    function closeDatalistDropdown(){
      const listId = el.manualInput.getAttribute("list");
      if (!listId) return;
      el.manualInput.setAttribute("list", "");
      setTimeout(() => el.manualInput.setAttribute("list", listId), 0);
    }
    async function setLocation(lat, lon, placeLabel, countryCode, source){
      state.lat = lat;
      state.lon = lon;
      state.placeLabel = placeLabel || "Near you";
      state.countryCode = countryCode || null;
      state.source = source || "manual";
      state.units = countryUsesF(state.countryCode) ? "F" : "C";
      saveState();

      setPill(state.placeLabel);
      updateSourceUI();
      setUnitControlButtons();

      await refreshWeather();
    }

    async function refreshWeather(){
      if (!state.lat || !state.lon){
        try{
          await useGPS(true);
          if (!state.lat || !state.lon) throw new Error("no_gps");
        }catch(e){
          const fallback = CURATED_CITIES[0];
          if (!fallback) return;
          await setLocation(fallback.lat, fallback.lon, fallback.label, fallback.cc, "auto");
          return;
        }
      }

      setLoadingUI();

      try{
        const data = await fetchOpenMeteo(state.lat, state.lon);
        state.lastForecast = buildDailyArray(data.daily || {});
        saveState();

        el.locName.textContent = state.placeLabel || "Near you";

        const now = renderNow(data.current || {});
        renderForecast(state.lastForecast);

        // Store current conditions for live verdict updates
        state.currentConditions = {
          feels: data.current?.apparent_temperature ?? 60,
          wind: data.current?.wind_speed_10m ?? 0,
          code: data.current?.weather_code ?? 0
        };
        saveState();
        
        // Get today's daily data for precipitation info
        const todayDaily = state.lastForecast?.[0];
        
        // Main verdict ALWAYS uses current conditions (right now)
        renderBigVerdict(
          state.currentConditions.feels,
          state.run,
          state.currentConditions.wind,
          todayDaily?.precip ?? 0,
          state.currentConditions.code
        );

      }catch(e){
        console.error(e);
        showToast("Weather data failed. Try again.");
      }finally{
        endLoadingUI();
      }
    }

    async function useGPS(silent=false){
      if (!navigator.geolocation) throw new Error("no_gps");
      return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(async (pos)=>{
          try{
            const { latitude:lat, longitude:lon } = pos.coords;
            const rev = await reverseGeocodeToLabel(lat, lon);
            await setLocation(lat, lon, rev.label, rev.cc, "gps");
            if (!silent) showToast("Location set by GPS");
            resolve();
          }catch(err){ reject(err); }
        }, (err)=>{
          if (!silent) showToast("GPS denied. Use manual or Spin.");
          reject(err);
        }, { enableHighAccuracy:true, timeout: 12000, maximumAge: 60000 });
      });
    }

    function handleManualSelection(choice){
      if (!choice) return;
      setLocation(choice.lat, choice.lon, choice.label, choice.countryCode, "manual").catch(()=>{});
    }

    function spinCity(){
      if (!Array.isArray(state.spinSeen)) state.spinSeen = [];
      const all = CURATED_CITIES.map((_,i)=>i);
      const remaining = all.filter(i => !state.spinSeen.includes(i));
      const pickIdx = remaining.length ? remaining[Math.floor(Math.random()*remaining.length)] : all[Math.floor(Math.random()*all.length)];
      const city = CURATED_CITIES[pickIdx];
      state.spinSeen = remaining.length ? [...state.spinSeen, pickIdx] : [pickIdx];
      saveState();
      setLocation(city.lat, city.lon, city.label, city.cc, "globe");
      showToast("Spun the globe: " + city.label);
    }

    el.unitAuto.addEventListener("click", ()=>{
      state.unitOverride = null;
      setUnitControlButtons();
      refreshWeather();
    });
    el.unitF.addEventListener("click", ()=>{
      state.unitOverride = "F";
      setUnitControlButtons();
      refreshWeather();
    });
    el.unitC.addEventListener("click", ()=>{
      state.unitOverride = "C";
      setUnitControlButtons();
      refreshWeather();
    });

    el.brandHome.addEventListener("click", ()=>{ refreshWeather(); });
    el.wherePill.addEventListener("click", ()=>{ el.detailsCard.scrollIntoView({ behavior:"smooth" }); });

    el.runSelect.value = state.run || "normal";
    el.runSelect.addEventListener("change", ()=>{
      state.run = el.runSelect.value;
      saveState();

      // Update the selected forecast day's details panel
      const d = state.lastForecast?.[state.selectedIdx ?? 0];
      if (d) renderDetails(d, state.run);

      // Update big verdict using CURRENT conditions (not forecast)
      if (state.currentConditions){
        const todayDaily = state.lastForecast?.[0];
        renderBigVerdict(
          state.currentConditions.feels,
          state.run,
          state.currentConditions.wind,
          todayDaily?.precip ?? 0,
          state.currentConditions.code
        );
      }
    });

    el.spinBtn.addEventListener("click", ()=>{ spinCity(); });
    el.gpsBtn.addEventListener("click", ()=>{ useGPS().catch(()=>{}); });

    function clearAndBlurInput(){
      el.locList.innerHTML = "";
      closeDatalistDropdown();
      el.manualInput.blur();
    }

    el.manualInput.addEventListener("input", (e)=>{
      const q = e.target.value.trim();
      if (!q){ el.locList.innerHTML=""; return; }
      clearTimeout(suggestTimer);
      const seq = ++suggestSeq;
      suggestTimer = setTimeout(async ()=>{
        try{
          const results = await geocodeDisplayName(q);
          if (seq !== suggestSeq) return;
          el.locList.innerHTML = results.map(r =>
            "<option value=\"" + r.label.replaceAll("\"","&quot;") + "\" data-lat=\"" + r.lat + "\" data-lon=\"" + r.lon + "\" data-cc=\"" + (r.countryCode || "") + "\"></option>"
          ).join("");
        }catch(err){ console.error(err); }
      }, 250);
    });

    el.manualInput.addEventListener("change", ()=>{
      const val = el.manualInput.value.trim();
      if (!val) return;

      const opt = [...el.locList.children].find(o => o.value === val);
      if (opt){
        handleManualSelection({
          label: opt.value,
          lat: Number(opt.dataset.lat),
          lon: Number(opt.dataset.lon),
          countryCode: opt.dataset.cc || null
        });
        clearAndBlurInput();
      }else{
        geocodeDisplayName(val).then(res=>{
          if (res[0]) handleManualSelection(res[0]);
          clearAndBlurInput();
        }).catch(()=>{
          showToast("Could not find that place.");
          clearAndBlurInput();
        });
      }
    });

    el.manualInput.addEventListener("keydown", (e)=>{
      if (e.key === "Enter"){
        const val = el.manualInput.value.trim();
        const opt = [...el.locList.children].find(o => o.value === val);
        if (opt){
          e.preventDefault();
          handleManualSelection({
            label: opt.value,
            lat: Number(opt.dataset.lat),
            lon: Number(opt.dataset.lon),
            countryCode: opt.dataset.cc || null
          });
          clearAndBlurInput();
        }
      }
    });

    setUnitControlButtons();
    setPill(state.placeLabel || "Near you");
    updateSourceUI();
    setLoadingUI();
    handleResponsive();
    applyTheme();
    
    // Initialize timestamp if it exists
    if (state.lastUpdated && el.lastUpdated) {
      const now = new Date(state.lastUpdated);
      const timeStr = now.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' });
      el.lastUpdated.textContent = `Updated ${timeStr}`;
    }
    
    refreshWeather();

    window.addEventListener("resize", handleResponsive);
    
    // New button event listeners
    el.refreshBtn?.addEventListener("click", () => {
      el.refreshBtn.classList.add("spinning");
      refreshWeather().finally(() => {
        setTimeout(() => el.refreshBtn.classList.remove("spinning"), 800);
      });
    });
    
    el.themeBtn?.addEventListener("click", toggleTheme);
    el.shareBtn?.addEventListener("click", shareVerdict);
  </script>
</body>
</html></body>
</html>
